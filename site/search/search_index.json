{"config":{"lang":["en"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"KYCC \u2014 Know Your Customer's Customer","text":""},{"location":"#overview","title":"Overview","text":"<p>KYCC is an enterprise-grade supply chain intelligence and credit scoring platform. It models companies (parties), their relationships, transactions, and automatically computes creditworthiness scores using a feature-based scorecard model.</p>"},{"location":"#what-the-system-does","title":"What the System Does","text":"<ol> <li>Stores supply chain data: Parties (suppliers, manufacturers, distributors, retailers), relationships between them, and transaction history</li> <li>Extracts features: Automatically derives meaningful financial and network signals from raw data (KYC scores, transaction counts, network depth, etc.)</li> <li>Computes credit scores: Applies a weighted scorecard model to produce 300-900 credit scores (FICO-like standard)</li> <li>Applies business rules: Enforces decision rules (approve/reject/flag/manual review) based on scores and features</li> <li>Audits everything: Logs all scoring requests with full feature snapshots for complete explainability and compliance</li> </ol>"},{"location":"#key-technologies","title":"Key Technologies","text":"Layer Technology Purpose API FastAPI + Python 3.11 REST API with 23 endpoints, async, auto-generated docs Database PostgreSQL 15 + SQLAlchemy 2.x Relational data, ORM, temporal features, JSON support Validation Pydantic v2 Type-safe API schemas, ORM integration Frontend React (esbuild) Interactive web UI, visualizations Alternative UI Streamlit Lightweight testing UI, rapid prototyping"},{"location":"#tech-stack-rationale","title":"Tech Stack Rationale","text":"<ul> <li>FastAPI: Type hints, async support, auto-generated OpenAPI docs, integration with Pydantic</li> <li>SQLAlchemy 2.x: Modern async support, clear ORM relationships, session management, query builder</li> <li>PostgreSQL: Native JSON support (for feature snapshots), recursive CTEs (for graph traversal), ACID guarantees</li> <li>Pydantic v2: Strict validation, ORM mode for automatic conversion, field aliases and custom namespaces</li> <li>React: Component-based, state management, D3/Plotly for visualizations</li> </ul>"},{"location":"#system-architecture","title":"System Architecture","text":""},{"location":"#high-level-data-flow","title":"High-Level Data Flow","text":"<pre><code>User Request (Frontend or API)\n        \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  FastAPI REST API (main.py)         \u2502\n\u2502  - 23 routes across 3 routers       \u2502\n\u2502  - CORS enabled for localhost       \u2502\n\u2502  - Pydantic validation              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Scoring Service                    \u2502\n\u2502  (app/services/scoring_service.py)  \u2502\n\u2502  1. Trigger feature extraction      \u2502\n\u2502  2. Fetch scoring model             \u2502\n\u2502  3. Apply scorecard algorithm       \u2502\n\u2502  4. Apply decision rules            \u2502\n\u2502  5. Generate audit log              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Feature Pipeline Service           \u2502\n\u2502  (app/services/feature_pipeline...) \u2502\n\u2502  Orchestrates 3 extractors:         \u2502\n\u2502  - KYC Extractor (Party table)      \u2502\n\u2502  - Transaction Extractor (Txn hist) \u2502\n\u2502  - Network Extractor (Relationships)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SQLAlchemy ORM Layer               \u2502\n\u2502  - Reads: Party, Transaction, Rel.  \u2502\n\u2502  - Writes: features, score_requests \u2502\n\u2502  - Session management + pooling     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2193\nPostgreSQL 15 (Primary) or SQLite (Fallback)\n        \u2193\nResponse \u2192 Serialized JSON \u2192 Frontend Display\n</code></pre>"},{"location":"#component-interaction-map","title":"Component Interaction Map","text":"Component Depends On Provides When Called FastAPI Router Database, Scoring Service HTTP JSON response Client calls <code>/api/scoring/score/{id}</code> Scoring Service Feature Pipeline, Model Registry, Decision Rules Credit score + decision + audit log Router calls <code>compute_score(party_id)</code> Feature Pipeline 3 Extractors, Database Feature dictionary Scoring Service calls <code>_ensure_features_exist()</code> KYC Extractor Party table <code>{kyc_score, company_age_days, party_type_encoded, ...}</code> Pipeline calls <code>.extract(party_id, db)</code> Transaction Extractor Transaction table <code>{transaction_count, avg_amount, regularity, recency}</code> Pipeline calls <code>.extract(party_id, db)</code> Network Extractor Relationship table <code>{network_size, counterparty_count, network_depth}</code> Pipeline calls <code>.extract(party_id, db)</code> Model Registry Database (SELECT) Active scorecard weights + intercept Scoring Service queries during compute Decision Rules Database (SELECT) Rule conditions + actions Scoring Service evaluates after score Feature Storage Database (INSERT/UPDATE) Versioned features with valid_from/valid_to Pipeline calls <code>_store_features()</code>"},{"location":"#core-scoring-logic","title":"Core Scoring Logic","text":""},{"location":"#1-feature-extraction-parallel-multi-source","title":"1. Feature Extraction (Parallel, Multi-Source)","text":"<p>Purpose: Convert raw company data into normalized numerical features suitable for credit scoring.</p> <p>Three extractors run in parallel and are combined:</p>"},{"location":"#kyc-extractor","title":"KYC Extractor","text":"<pre><code># Reads from: parties table\n\nfeatures = {\n  \"kyc_score\": 85,                    # from Party.kyc_verified (0-100)\n  \"company_age_days\": 180,            # days since Party.created_at\n  \"party_type_encoded\": 1,            # numeric encoding: supplier=1, mfg=2, etc.\n  \"contact_completeness\": 75          # % of contact fields filled\n}\n</code></pre> <p>Why these features? - KYC score: Indicator of compliance and due diligence completion - Company age: Older = more established (lower risk) - Party type: Some types considered inherently lower risk - Contact completeness: Better data quality = lower risk</p>"},{"location":"#transaction-extractor","title":"Transaction Extractor","text":"<pre><code># Reads from: transactions table (filtered by party_id)\n\nfeatures = {\n  \"transaction_count\": 15,            # total txns in history\n  \"avg_transaction_amount\": 5000,     # mean transaction value ($)\n  \"transaction_regularity\": 0.96,     # 1 - (std_dev / mean), high = consistent\n  \"days_since_last_transaction\": 2    # recency (lower = more active)\n}\n</code></pre> <p>Why these features? - Volume: More transactions = longer business history - Consistency: Regular txns indicate stable, predictable business - Recency: Recent activity = company is currently operating</p>"},{"location":"#network-extractor","title":"Network Extractor","text":"<pre><code># Reads from: relationships table (graph traversal)\n\nfeatures = {\n  \"network_size\": 2,                  # total distinct parties in component\n  \"counterparty_count\": 1,            # immediate neighbors (suppliers + customers)\n  \"network_depth\": 2                  # max hops in relationship graph\n}\n</code></pre> <p>Why these features? - Network size: Larger supply chains indicate established position - Counterparty count: Diversified customer/supplier base = lower concentration risk - Network depth: Deep integration in supply chain = important player</p>"},{"location":"#feature-versioning-temporal-validity","title":"Feature Versioning (Temporal Validity)","text":"<pre><code>-- Storage model in features table:\nparty_id: 1\nfeature_name: \"kyc_score\"\nfeature_value: 85.0\nsource_type: \"KYC\"\nvalid_from: 2025-12-12T10:30:00\nvalid_to: NULL                -- NULL = current version (active)\n\n-- When re-computed 7 days later:\n-- UPDATE old record: valid_to = 2025-12-19T10:30:00 (mark as expired)\n-- INSERT new record: valid_from = 2025-12-19T10:30:00, valid_to = NULL\n\n-- Benefits:\n-- \u2705 Historical audit: can replay old scores with old features\n-- \u2705 Debugging: compare how feature values changed over time\n-- \u2705 Rollback: revert to old features if extraction logic was wrong\n</code></pre>"},{"location":"#2-scorecard-scoring-algorithm-weighted-linear-model","title":"2. Scorecard Scoring Algorithm (Weighted Linear Model)","text":"<p>Algorithm: <code>score = intercept + \u03a3(normalized_feature[i] \u00d7 weight[i])</code></p> <p>Step 1: Normalize Features (0-1 Scale)</p> <p>Raw features come in different units (days, dollars, counts, percentages). Normalize using min-max scaling:</p> <pre><code>normalized = (value - min) / (max - min)\n\nExamples:\n  kyc_score: 85 \u2192 0.85 (divide by 100)\n  company_age_days: 180 \u2192 0.49 (assume max ~365)\n  transaction_count: 15 \u2192 0.75 (assume max ~20)\n  transaction_regularity: 0.96 \u2192 0.96 (already in 0-1 range)\n</code></pre> <p>Step 2: Fetch Model from model_registry</p> <pre><code>SELECT model_version, model_config, feature_list, intercept\nFROM model_registry\nWHERE is_active = 1\nORDER BY deployed_date DESC\nLIMIT 1;\n\n-- Returns:\n{\n  \"model_version\": \"default_scorecard_v1\",\n  \"intercept\": 0.0,\n  \"weights\": {\n    \"kyc_score\": 0.20,\n    \"company_age_days\": 0.10,\n    \"transaction_count\": 0.25,\n    \"transaction_regularity\": 0.15,\n    \"days_since_last_transaction\": 0.10,\n    \"network_size\": 0.10,\n    \"counterparty_count\": 0.05\n  }\n}\n</code></pre> <p>Step 3: Apply Weighted Sum</p> <pre><code>score_0_to_1 = intercept\nscore_0_to_1 += 0.85 * 0.20    # kyc_score: 0.17\nscore_0_to_1 += 0.49 * 0.10    # company_age: 0.049\nscore_0_to_1 += 0.75 * 0.25    # transaction_count: 0.1875\nscore_0_to_1 += 0.96 * 0.15    # regularity: 0.144\nscore_0_to_1 += 0.99 * 0.10    # recency: 0.099\nscore_0_to_1 += 0.33 * 0.10    # network_size: 0.033\nscore_0_to_1 += 0.25 * 0.05    # counterparty: 0.0125\n# = 0.769 (on 0-1 scale)\n</code></pre> <p>Step 4: Scale to 300-900 Range (FICO-like)</p> <p>Why 300-900? Industry standard for credit scores (FICO, VantageScore). Makes scores interpretable to domain experts.</p> <pre><code>final_score = 300 + (score_0_to_1 \u00d7 600)\n            = 300 + (0.769 \u00d7 600)\n            = 300 + 461.4\n            = 761 \u2713\n</code></pre> <p>Step 5: Assign Score Band</p> <pre><code>if final_score &gt;= 800:\n    band = \"excellent\"\nelif final_score &gt;= 650:\n    band = \"good\"          \u2190 761 falls here\nelif final_score &gt;= 550:\n    band = \"fair\"\nelse:\n    band = \"poor\"\n</code></pre> <p>Step 6: Compute Confidence</p> <pre><code>confidence = count(available_features) / total_expected_features\n           = 8 / 15 = 0.53\n\n# Higher confidence = more features were available for scoring\n</code></pre> <p>Why Linear Scorecard? - \u2705 Interpretable: Easy to explain which features drive score - \u2705 Fast: O(n) computation (fast even with many features) - \u2705 Auditable: Weights stored in database, versioned - \u2705 ML-Ready: Scorecard is a special case of logistic regression (can swap in ML later) - \u2705 Regulatory: Easier to comply with explainability requirements</p>"},{"location":"#3-decision-rules-engine","title":"3. Decision Rules Engine","text":"<p>Purpose: Apply business rules on top of the raw score to produce final decision.</p>"},{"location":"#rule-structure","title":"Rule Structure","text":"<pre><code>class DecisionRule:\n    rule_id: str                  # \"RULE_001\"\n    rule_name: str                # \"Reject low KYC\"\n    condition_expression: str     # Python expression: \"kyc_score &lt; 50\"\n    action: str                   # \"reject\" | \"flag\" | \"manual_review\" | \"approve\"\n    priority: int                 # 1=highest (first match wins)\n    is_active: bool               # only evaluate active rules\n</code></pre>"},{"location":"#evaluation-logic","title":"Evaluation Logic","text":"<pre><code>def apply_decision_rules(features: dict) -&gt; (decision, reasons):\n    rules = db.query(DecisionRule)\\\n        .filter(DecisionRule.is_active.in_([1, True]))\\\n        .order_by(DecisionRule.priority)\\\n        .all()\n\n    for rule in rules:\n        try:\n            # Build safe evaluation context (no builtins)\n            safe_context = {\"__builtins__\": {}}\n            safe_context.update(features)\n\n            # Evaluate rule condition with feature values\n            if eval(rule.condition_expression, safe_context):\n                return rule.action, [rule.rule_name]\n        except Exception:\n            # Skip rules that fail to evaluate\n            pass\n\n    # Default if no rules matched\n    return \"approved\", []\n</code></pre>"},{"location":"#example-decision-rules","title":"Example Decision Rules","text":"Priority Condition Action Reason 1 <code>transaction_count == 0</code> reject No transaction history = cannot assess 2 <code>kyc_score &lt; 40</code> reject Very poor KYC verification 3 <code>network_size &lt; 2</code> flag Isolated in supply chain (risky) 4 <code>company_age_days &lt; 30</code> manual_review Too new to assess 5 <code>final_score &gt; 800</code> approve Excellent creditworthiness"},{"location":"#safety-notes","title":"Safety Notes","text":"<ul> <li>Only <code>__builtins__</code> removed (no <code>open()</code>, <code>exec()</code>, <code>import</code>)</li> <li>Features dict provides variable context</li> <li>Failed expressions skip silently (don't break entire scoring)</li> <li>Production: Use expression parser like <code>simpleeval</code> instead of <code>eval()</code></li> </ul>"},{"location":"#4-audit-logging-complete-traceability","title":"4. Audit Logging (Complete Traceability)","text":"<p>Every score computation creates a ScoreRequest record:</p> <pre><code>class ScoreRequest:\n    id: str                          # UUID\n    party_id: int                    # Which company?\n    request_timestamp: datetime      # When scored\n    model_version: str               # \"default_scorecard_v1\"\n    model_type: str                  # \"scorecard\" | \"ml_model\"\n    features_snapshot: JSON          # All features used (for replay)\n    raw_score: float                 # 0-1\n    final_score: int                 # 300-900\n    score_band: str                  # excellent/good/fair/poor\n    confidence_level: float          # % of available features\n    decision: str                    # approve/reject/flag/review\n    decision_reasons: JSON           # [rule names that matched]\n    processing_time_ms: int\n</code></pre> <p>Benefits: - \u2705 Explainability: Show user \"these features were used at score time\" - \u2705 Audit Trail: When was company scored? By which model? - \u2705 Replay: If model weights change, re-run old scores with old features - \u2705 Debugging: If score seems wrong, check features_snapshot - \u2705 Compliance: Full traceability for regulatory reviews</p> <p>Example Snapshot: <pre><code>{\n  \"kyc_score\": 85,\n  \"company_age_days\": 180,\n  \"party_type_encoded\": 1,\n  \"contact_completeness\": 75,\n  \"transaction_count\": 15,\n  \"avg_transaction_amount\": 5000,\n  \"transaction_regularity\": 0.96,\n  \"days_since_last_transaction\": 2,\n  \"network_size\": 2,\n  \"counterparty_count\": 1,\n  \"network_depth\": 2\n}\n</code></pre></p>"},{"location":"#complete-example-scoring-three-companies","title":"Complete Example: Scoring Three Companies","text":""},{"location":"#setup-three-test-parties-in-supply-chain","title":"Setup: Three Test Parties in Supply Chain","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SUPPLY CHAIN NETWORK                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Party 1: ACME SUPPLIERS (supplier)                    \u2502\n\u2502    \u251c\u2500 Created: 180 days ago                            \u2502\n\u2502    \u251c\u2500 KYC Score: 85/100                                \u2502\n\u2502    \u251c\u2500 Transactions: 15 to Global Distributor           \u2502\n\u2502    \u2502   - Avg: $5,000 each                              \u2502\n\u2502    \u2502   - Regularity: Very consistent (std_dev: $200)   \u2502\n\u2502    \u2502   - Latest: 2 days ago                            \u2502\n\u2502    \u2514\u2500 Network: 1 direct customer (Global)              \u2502\n\u2502                                                         \u2502\n\u2502  \u2193 supplies_to                                          \u2502\n\u2502                                                         \u2502\n\u2502  Party 2: GLOBAL DISTRIBUTOR (distributor)             \u2502\n\u2502    \u251c\u2500 Created: 200 days ago                            \u2502\n\u2502    \u251c\u2500 KYC Score: 92/100                                \u2502\n\u2502    \u251c\u2500 Transactions: 8 to Local Retailer                \u2502\n\u2502    \u2502   - Avg: $3,000 each                              \u2502\n\u2502    \u2502   - Regularity: Somewhat irregular (std_dev: $1.5k)\n\u2502    \u2502   - Latest: 5 days ago                            \u2502\n\u2502    \u251c\u2500 Upstream: 1 supplier (ACME)                      \u2502\n\u2502    \u2514\u2500 Downstream: 1 customer (Local Retailer)          \u2502\n\u2502                                                         \u2502\n\u2502  \u2193 distributes_to                                       \u2502\n\u2502                                                         \u2502\n\u2502  Party 3: LOCAL RETAILER (retailer)                    \u2502\n\u2502    \u251c\u2500 Created: 30 days ago                             \u2502\n\u2502    \u251c\u2500 KYC Score: 60/100                                \u2502\n\u2502    \u251c\u2500 Transactions: 2 total                            \u2502\n\u2502    \u2502   - Avg: $500 each                                \u2502\n\u2502    \u2502   - Regularity: Very irregular                    \u2502\n\u2502    \u2502   - Latest: 1 day ago (recent)                    \u2502\n\u2502    \u2514\u2500 Upstream: 1 supplier (Global)                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"#step-by-step-computing-score-for-acme-suppliers-party-1","title":"Step-by-Step: Computing Score for ACME SUPPLIERS (Party 1)","text":""},{"location":"#step-1-user-clicks-compute-credit-score-in-frontend","title":"Step 1: User Clicks \"Compute Credit Score\" in Frontend","text":"<pre><code>// React component\nonClick={() =&gt; fetch(\n  `http://localhost:8001/api/scoring/score/1`,\n  { method: 'POST', headers: { 'Content-Type': 'application/json' } }\n)}\n</code></pre>"},{"location":"#step-2-api-receives-request","title":"Step 2: API Receives Request","text":"<pre><code># app/api/scoring.py\n@router.post(\"/api/scoring/score/{party_id}\")\ndef get_credit_score(\n    party_id: int,\n    model_version: Optional[str] = None,\n    include_explanation: bool = True,\n    db: Session = Depends(get_db)\n) \u2192 ScoreResponse:\n    scoring_service = ScoringService(db)\n    result = scoring_service.compute_score(party_id=1)\n    return result  # JSON serialized by Pydantic\n</code></pre>"},{"location":"#step-3-scoring-service-ensures-features-are-fresh","title":"Step 3: Scoring Service Ensures Features Are Fresh","text":"<pre><code># app/services/scoring_service.py\n\ndef compute_score(self, party_id: int):\n    # Check if features already computed and not stale (&lt; 7 days)\n    latest = db.query(Feature)\\\n        .filter(Feature.party_id == 1, Feature.valid_to == None)\\\n        .first()\n\n    if not latest or (datetime.utcnow() - latest.computation_timestamp).days &gt; 7:\n        # Trigger extraction\n        pipeline = FeaturePipelineService(db)\n        pipeline.extract_all_features(party_id=1)\n</code></pre>"},{"location":"#step-4-feature-pipeline-orchestrates-extraction","title":"Step 4: Feature Pipeline Orchestrates Extraction","text":"<pre><code># Three extractors run in parallel context:\n\nKYC_EXTRACTOR.extract(party_id=1, db):\n  party = db.query(Party).filter(Party.id == 1).first()  # ACME SUPPLIERS\n  return [\n    FeatureExtractorResult(\"kyc_score\", 85.0),\n    FeatureExtractorResult(\"company_age_days\", 180.0),\n    FeatureExtractorResult(\"party_type_encoded\", 1.0),    # supplier=1\n    FeatureExtractorResult(\"contact_completeness\", 75.0)\n  ]\n\nTRANSACTION_EXTRACTOR.extract(party_id=1, db):\n  txns = db.query(Transaction).filter(Transaction.from_party_id == 1).all()\n  # 15 transactions to Global Distributor\n  return [\n    FeatureExtractorResult(\"transaction_count\", 15.0),\n    FeatureExtractorResult(\"avg_transaction_amount\", 5000.0),\n    FeatureExtractorResult(\"transaction_regularity\", 0.96),  # very consistent\n    FeatureExtractorResult(\"days_since_last_transaction\", 2.0)\n  ]\n\nNETWORK_EXTRACTOR.extract(party_id=1, db):\n  # Graph traversal: ACME \u2192 Global \u2192 Local\n  # ACME has 1 direct customer (Global)\n  return [\n    FeatureExtractorResult(\"network_size\", 2.0),           # ACME + Global\n    FeatureExtractorResult(\"counterparty_count\", 1.0),     # 1 direct customer\n    FeatureExtractorResult(\"network_depth\", 2.0)           # 2 hops downstream\n  ]\n</code></pre>"},{"location":"#step-5-store-features-in-database-versioned","title":"Step 5: Store Features in Database (Versioned)","text":"<pre><code>INSERT INTO features (party_id, feature_name, feature_value, source_type, valid_from)\nVALUES\n  (1, 'kyc_score', 85.0, 'KYC', 2025-12-12 10:30:00),\n  (1, 'company_age_days', 180.0, 'KYC', 2025-12-12 10:30:00),\n  (1, 'party_type_encoded', 1.0, 'KYC', 2025-12-12 10:30:00),\n  (1, 'contact_completeness', 75.0, 'KYC', 2025-12-12 10:30:00),\n  (1, 'transaction_count', 15.0, 'TRANSACTION', 2025-12-12 10:30:00),\n  (1, 'avg_transaction_amount', 5000.0, 'TRANSACTION', 2025-12-12 10:30:00),\n  (1, 'transaction_regularity', 0.96, 'TRANSACTION', 2025-12-12 10:30:00),\n  (1, 'days_since_last_transaction', 2.0, 'TRANSACTION', 2025-12-12 10:30:00),\n  (1, 'network_size', 2.0, 'NETWORK', 2025-12-12 10:30:00),\n  (1, 'counterparty_count', 1.0, 'NETWORK', 2025-12-12 10:30:00),\n  (1, 'network_depth', 2.0, 'NETWORK', 2025-12-12 10:30:00);\n</code></pre>"},{"location":"#step-6-normalize-features-to-0-1-scale","title":"Step 6: Normalize Features to 0-1 Scale","text":"<pre><code>normalized_features = {\n    'kyc_score': 85.0 / 100.0 = 0.85,\n    'company_age_days': 180.0 / 365.0 = 0.49,\n    'party_type_encoded': 1.0 / 5.0 = 0.20,\n    'contact_completeness': 75.0 / 100.0 = 0.75,\n    'transaction_count': 15.0 / 20.0 = 0.75,\n    'avg_transaction_amount': 5000.0 / 7500.0 = 0.67,\n    'transaction_regularity': 0.96,\n    'days_since_last_transaction': (365.0 - 2.0) / 365.0 = 0.99,\n    'network_size': 2.0 / 6.0 = 0.33,\n    'counterparty_count': 1.0 / 4.0 = 0.25,\n    'network_depth': 2.0 / 3.0 = 0.67\n}\n</code></pre>"},{"location":"#step-7-fetch-scorecard-model","title":"Step 7: Fetch Scorecard Model","text":"<pre><code>SELECT * FROM model_registry\nWHERE is_active = 1\nORDER BY deployed_date DESC\nLIMIT 1;\n\n-- Returns:\n{\n  model_version: \"default_scorecard_v1\",\n  model_type: \"scorecard\",\n  is_active: 1,\n  intercept: 0.0,\n  weights: {\n    \"kyc_score\": 0.20,\n    \"company_age_days\": 0.10,\n    \"party_type_encoded\": 0.05,\n    \"contact_completeness\": 0.00,\n    \"transaction_count\": 0.25,\n    \"avg_transaction_amount\": 0.05,\n    \"transaction_regularity\": 0.15,\n    \"days_since_last_transaction\": 0.10,\n    \"network_size\": 0.10,\n    \"counterparty_count\": 0.05,\n    \"network_depth\": 0.00\n  }\n}\n</code></pre>"},{"location":"#step-8-apply-scorecard-formula-weighted-sum","title":"Step 8: Apply Scorecard Formula (Weighted Sum)","text":"<pre><code>score_0_to_1 = 0.0  # intercept\n\n# Apply each feature weight\nscore_0_to_1 += 0.85 * 0.20       # kyc_score = 0.170\nscore_0_to_1 += 0.49 * 0.10       # company_age = 0.049\nscore_0_to_1 += 0.20 * 0.05       # party_type = 0.010\nscore_0_to_1 += 0.75 * 0.00       # contact = 0.000\nscore_0_to_1 += 0.75 * 0.25       # transaction_count = 0.1875\nscore_0_to_1 += 0.67 * 0.05       # avg_amount = 0.0335\nscore_0_to_1 += 0.96 * 0.15       # regularity = 0.144\nscore_0_to_1 += 0.99 * 0.10       # recency = 0.099\nscore_0_to_1 += 0.33 * 0.10       # network_size = 0.033\nscore_0_to_1 += 0.25 * 0.05       # counterparty = 0.0125\nscore_0_to_1 += 0.67 * 0.00       # network_depth = 0.000\n\n# Total: 0.769 (on 0-1 scale)\n</code></pre>"},{"location":"#step-9-scale-to-credit-score-range-300-900","title":"Step 9: Scale to Credit Score Range (300-900)","text":"<pre><code>final_score = 300 + (0.769 * 600)\n            = 300 + 461.4\n            = 761 \u2713\n\nscore_band = \"good\" (650-800 range)\nconfidence = 10 / 11 = 0.91 (10 features used, 11 defined)\n</code></pre>"},{"location":"#step-10-apply-decision-rules","title":"Step 10: Apply Decision Rules","text":"<pre><code>SELECT * FROM decision_rules\nWHERE is_active = 1\nORDER BY priority;\n\n-- Evaluation:\n\nRule 1 (Priority 1): \"Reject if no transactions\"\n  Condition: transaction_count == 0\n  Eval: 15 == 0? NO \u2192 skip\n\nRule 2 (Priority 2): \"Reject if kyc_score &lt; 40\"\n  Condition: kyc_score &lt; 40\n  Eval: 85 &lt; 40? NO \u2192 skip\n\nRule 3 (Priority 3): \"Flag if network_size &lt; 2\"\n  Condition: network_size &lt; 2\n  Eval: 2 &lt; 2? NO \u2192 skip\n\nRule 4 (Priority 4): \"Approve if final_score &gt; 750\"\n  Condition: final_score &gt; 750\n  Eval: 761 &gt; 750? YES \u2713 \u2192 MATCH!\n\nFinal Decision: APPROVE\nReasons: [\"Rule 4: Approve if final_score &gt; 750\"]\n</code></pre>"},{"location":"#step-11-create-audit-log","title":"Step 11: Create Audit Log","text":"<pre><code>score_request = ScoreRequest(\n    id=\"550e8400-e29b-41d4-a716-446655440000\",  # UUID\n    party_id=1,\n    model_version=\"default_scorecard_v1\",\n    model_type=\"scorecard\",\n    features_snapshot=json.dumps({\n        \"kyc_score\": 85.0,\n        \"company_age_days\": 180.0,\n        \"party_type_encoded\": 1.0,\n        \"contact_completeness\": 75.0,\n        \"transaction_count\": 15.0,\n        \"avg_transaction_amount\": 5000.0,\n        \"transaction_regularity\": 0.96,\n        \"days_since_last_transaction\": 2.0,\n        \"network_size\": 2.0,\n        \"counterparty_count\": 1.0,\n        \"network_depth\": 2.0\n    }),\n    raw_score=0.769,\n    final_score=761,\n    score_band=\"good\",\n    confidence_level=0.91,\n    decision=\"APPROVE\",\n    decision_reasons=json.dumps([\n        \"Rule 4: Approve if final_score &gt; 750\"\n    ]),\n    processing_time_ms=145,\n    request_timestamp=datetime.utcnow()\n)\ndb.add(score_request)\ndb.commit()\n</code></pre>"},{"location":"#step-12-return-response-to-api","title":"Step 12: Return Response to API","text":"<pre><code>{\n  \"party_id\": 1,\n  \"score\": 761,\n  \"score_band\": \"good\",\n  \"confidence\": 0.91,\n  \"decision\": \"APPROVE\",\n  \"decision_reasons\": [\n    \"Rule 4: Approve if final_score &gt; 750\"\n  ],\n  \"explanation\": {\n    \"top_positive_factors\": [\n      {\n        \"feature\": \"transaction_count\",\n        \"value\": 15.0,\n        \"contribution\": 0.1875\n      },\n      {\n        \"feature\": \"transaction_regularity\",\n        \"value\": 0.96,\n        \"contribution\": 0.144\n      },\n      {\n        \"feature\": \"kyc_score\",\n        \"value\": 85.0,\n        \"contribution\": 0.170\n      }\n    ],\n    \"top_negative_factors\": []\n  },\n  \"computed_at\": \"2025-12-12T10:31:00\",\n  \"model_version\": \"default_scorecard_v1\"\n}\n</code></pre>"},{"location":"#step-13-frontend-displays-results","title":"Step 13: Frontend Displays Results","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ACME SUPPLIERS - Credit Assessment   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                        \u2502\n\u2502        Credit Score: 761               \u2502\n\u2502        \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591 66%        \u2502\n\u2502                                        \u2502\n\u2502  Band: GOOD                            \u2502\n\u2502  Decision: \u2705 APPROVE                  \u2502\n\u2502  Confidence: 91%                       \u2502\n\u2502                                        \u2502\n\u2502  Scoring Breakdown:                    \u2502\n\u2502  \u2022 Transaction Count:      +0.1875     \u2502\n\u2502  \u2022 Regularity:             +0.144      \u2502\n\u2502  \u2022 KYC Score:              +0.170      \u2502\n\u2502  \u2022 Days Since Last Txn:    +0.099      \u2502\n\u2502  \u2022 Company Age:            +0.049      \u2502\n\u2502  \u2022 Network Size:           +0.033      \u2502\n\u2502  \u2022 Counterparty Count:     +0.0125     \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2502\n\u2502  Total (Raw): 0.769 \u2192 Final: 761       \u2502\n\u2502                                        \u2502\n\u2502  Rules Applied:                        \u2502\n\u2502  \u2713 Rule 4: Approve if score &gt; 750      \u2502\n\u2502                                        \u2502\n\u2502  Computed: 2025-12-12 10:31:00         \u2502\n\u2502  Model: default_scorecard_v1           \u2502\n\u2502  Processing Time: 145ms                \u2502\n\u2502                                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"#summary-table-all-three-companies","title":"Summary Table: All Three Companies","text":"Company KYC Age Txns Regularity Score Band Decision ACME Suppliers (ID=1) 85 180d 15 0.96 761 GOOD \u2705 APPROVE Global Distributor (ID=2) 92 200d 8 0.70 748 GOOD \u26a0\ufe0f REVIEW Local Retailer (ID=3) 60 30d 2 0.40 425 POOR \u274c REJECT <p>Why Different Decisions?</p> <ul> <li>ACME (761): High KYC, consistent transactions, established history \u2192 APPROVE</li> <li>Global Distributor (748): High KYC but borderline score (748 vs 750 threshold) \u2192 requires MANUAL REVIEW</li> <li>Local Retailer (425): New company, low KYC, few transactions, isolation in network \u2192 REJECT per Rule 1</li> </ul>"},{"location":"#project-structure-components","title":"Project Structure &amp; Components","text":""},{"location":"#directory-layout","title":"Directory Layout","text":"<pre><code>KYCC/\n\u251c\u2500\u2500 backend/                           # FastAPI server\n\u2502   \u251c\u2500\u2500 __init__.py                   # Makes backend a package\n\u2502   \u251c\u2500\u2500 main.py                       # FastAPI app + 3 routers + health/stats\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 app/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 db/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 database.py           # Engine, SessionLocal, get_db()\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 crud.py               # Create/read/update/delete helpers\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 models.py             # 14 SQLAlchemy ORM models\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 schemas.py            # Pydantic validation schemas\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 parties.py            # /api/parties/* endpoints\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 relationships.py      # /api/relationships/* endpoints\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 scoring.py            # /api/scoring/* endpoints (\u2605 MAIN)\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 scoring_service.py    # Orchestrates scoring pipeline\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 feature_pipeline_service.py  # Orchestrates feature extraction\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 network_service.py    # Graph traversal for relationships\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500 extractors/\n\u2502   \u2502       \u251c\u2500\u2500 __init__.py\n\u2502   \u2502       \u251c\u2500\u2500 base_extractor.py     # BaseFeatureExtractor + FeatureExtractorResult\n\u2502   \u2502       \u251c\u2500\u2500 kyc_extractor.py      # KYC features from parties table\n\u2502   \u2502       \u251c\u2500\u2500 transaction_extractor.py  # Transaction features (volume, consistency)\n\u2502   \u2502       \u251c\u2500\u2500 network_extractor.py  # Network features (size, depth)\n\u2502       \u2502   \u2514\u2500\u2500 __pycache__/\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 alembic/                       # Database migrations (future)\n\u2502   \u2502   \u251c\u2500\u2500 env.py\n\u2502   \u2502   \u251c\u2500\u2500 README\n\u2502   \u2502   \u251c\u2500\u2500 script.py.mako\n\u2502   \u2502   \u2514\u2500\u2500 versions/\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 .env                           # Environment config (DO NOT COMMIT)\n\u2502   \u251c\u2500\u2500 alembic.ini                    # Alembic config\n\u2502   \u251c\u2500\u2500 requirements.txt                # Python dependencies\n\u2502   \u2514\u2500\u2500 test_*.py / view_database.py   # Test scripts\n\u2502\n\u251c\u2500\u2500 frontend/                           # React + Streamlit UIs\n\u2502   \u251c\u2500\u2500 src/\n\u2502   \u2502   \u251c\u2500\u2500 components/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 PartyList.jsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 PartyForm.jsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 CreditScore.jsx       # Display scoring results (\u2605)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 NetworkGraph.jsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 FeatureBreakdown.jsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251c\u2500\u2500 App.jsx                    # Main routing\n\u2502   \u2502   \u2514\u2500\u2500 index.js\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 streamlit_app.py               # Lightweight alternative UI\n\u2502   \u251c\u2500\u2500 package.json                   # Node dependencies\n\u2502   \u251c\u2500\u2500 esbuild.config.js             # Build configuration\n\u2502   \u2514\u2500\u2500 node_modules/\n\u2502\n\u251c\u2500\u2500 README.md                           # This file\n\u251c\u2500\u2500 .git/                               # Version control\n\u2514\u2500\u2500 .gitignore                          # Exclude .env, venv, etc.\n</code></pre>"},{"location":"#database-schema-logical","title":"Database Schema (Logical)","text":""},{"location":"#core-tables","title":"Core Tables","text":""},{"location":"#parties-supply-chain-actors","title":"<code>parties</code> (Supply Chain Actors)","text":"Column Type Notes id INT Primary key party_name VARCHAR Company name party_type VARCHAR supplier, manufacturer, distributor, retailer, customer kyc_verified INT 0-100 compliance score tax_id VARCHAR Tax identification address VARCHAR contact_person VARCHAR email VARCHAR phone VARCHAR created_at TIMESTAMP When registered updated_at TIMESTAMP Last modification"},{"location":"#relationships-supply-chain-connections","title":"<code>relationships</code> (Supply Chain Connections)","text":"Column Type Notes id INT Primary key from_party_id INT FK \u2192 parties to_party_id INT FK \u2192 parties relationship_type VARCHAR supplies_to, distributes_to, etc. created_at TIMESTAMP When created"},{"location":"#transactions-paymentshipment-history","title":"<code>transactions</code> (Payment/Shipment History)","text":"Column Type Notes id INT Primary key from_party_id INT FK \u2192 parties to_party_id INT FK \u2192 parties amount DECIMAL Transaction value transaction_date TIMESTAMP When occurred payment_type VARCHAR Cash, wire, crypto, etc. created_at TIMESTAMP"},{"location":"#scoring-features-tables","title":"Scoring &amp; Features Tables","text":""},{"location":"#features-extracted-signals-versioned","title":"<code>features</code> (Extracted Signals - Versioned)","text":"Column Type Notes id INT Primary key party_id INT FK \u2192 parties feature_name VARCHAR kyc_score, transaction_count, etc. feature_value DECIMAL Numerical value confidence_score DECIMAL 0-1, extractor confidence source_type VARCHAR KYC, TRANSACTION, NETWORK computation_timestamp TIMESTAMP When computed valid_from TIMESTAMP Start of validity valid_to TIMESTAMP End of validity (NULL = current) <p>Indices: - <code>(party_id, feature_name, valid_to)</code> - Fast lookup of current features</p>"},{"location":"#score_requests-audit-log-complete-traceability","title":"<code>score_requests</code> (Audit Log - Complete Traceability)","text":"Column Type Notes id VARCHAR UUID, primary key party_id INT FK \u2192 parties request_timestamp TIMESTAMP When scored model_version VARCHAR Scorecard ID model_type VARCHAR scorecard, ml_model features_snapshot JSON All features at scoring time raw_score DECIMAL 0-1 final_score INT 300-900 score_band VARCHAR excellent, good, fair, poor confidence_level DECIMAL 0-1 decision str approve, reject, flag, manual_review decision_reasons JSON Rule names that matched processing_time_ms INT Latency <p>Indices: - <code>(party_id)</code> - Lookup scores by company - <code>(request_timestamp DESC)</code> - Latest scores first</p>"},{"location":"#model_registry-scorecard-repository","title":"<code>model_registry</code> (Scorecard Repository)","text":"Column Type Notes model_version VARCHAR PK, e.g. \"default_scorecard_v1\" model_type VARCHAR scorecard, xgboost, neural_net model_config JSON Weights, intercept, hyperparams feature_list JSON [\"kyc_score\", \"transaction_count\", ...] intercept DECIMAL Offset for scorecard normalization_method VARCHAR min-max, z-score, etc. training_date TIMESTAMP When trained deployed_date TIMESTAMP When put in production is_active INT 0/1 (current model) performance_metrics JSON AUC, precision, recall, etc. description TEXT Notes created_by VARCHAR Model creator"},{"location":"#decision_rules-business-rules","title":"<code>decision_rules</code> (Business Rules)","text":"Column Type Notes rule_id VARCHAR PK, e.g. \"RULE_001\" rule_name VARCHAR Descriptive name condition_expression TEXT Python expression action VARCHAR approve, reject, flag, manual_review priority INT 1=highest (first match wins) is_active INT 0/1 (enable/disable) created_at TIMESTAMP updated_at TIMESTAMP"},{"location":"#api-endpoints-23-total","title":"API Endpoints (23 Total)","text":""},{"location":"#parties-crud-7-endpoints","title":"Parties CRUD (7 endpoints)","text":"<ul> <li><code>POST /api/parties/</code> \u2014 Create party</li> <li><code>GET /api/parties/</code> \u2014 List parties (filterable: <code>?party_type=supplier</code>)</li> <li><code>GET /api/parties/{id}</code> \u2014 Get one party</li> <li><code>PUT /api/parties/{id}</code> \u2014 Update party</li> <li><code>DELETE /api/parties/{id}</code> \u2014 Delete party</li> <li><code>GET /api/parties/{id}/network</code> \u2014 Get relationship graph (tree)</li> <li><code>GET /api/parties/{id}/counterparties</code> \u2014 Get direct neighbors only</li> </ul>"},{"location":"#relationships-crud-3-endpoints","title":"Relationships CRUD (3 endpoints)","text":"<ul> <li><code>POST /api/relationships/</code> \u2014 Create relationship</li> <li><code>GET /api/relationships/</code> \u2014 List relationships</li> <li><code>DELETE /api/relationships/{id}</code> \u2014 Remove relationship</li> </ul>"},{"location":"#scoring-4-endpoints","title":"Scoring \u2b50 (4 endpoints)","text":"<ul> <li><code>POST /api/scoring/score/{party_id}</code> \u2014 Compute credit score (MAIN)</li> <li><code>GET /api/scoring/score/{party_id}/history</code> \u2014 Score audit trail</li> <li><code>GET /api/scoring/features/{party_id}</code> \u2014 View extracted features</li> <li><code>POST /api/scoring/compute-features/{party_id}</code> \u2014 Manually trigger extraction</li> </ul>"},{"location":"#utility-3-endpoints","title":"Utility (3 endpoints)","text":"<ul> <li><code>GET /</code> \u2014 API info + endpoints list</li> <li><code>GET /health</code> \u2014 Health check</li> <li><code>GET /api/stats</code> \u2014 System statistics (party counts, avg scores, distributions)</li> </ul>"},{"location":"#setup-local-development","title":"Setup &amp; Local Development","text":""},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.11+</li> <li>Docker Desktop (for PostgreSQL)</li> <li>Node.js 18+ (optional, for React frontend)</li> </ul>"},{"location":"#step-1-clone-create-virtual-environment","title":"Step 1: Clone &amp; Create Virtual Environment","text":"<pre><code># Clone repo\ngit clone &lt;repo&gt; &amp;&amp; cd KYCC\n\n# Create Python venv\npython -m venv venv\nvenv\\Scripts\\Activate.ps1  # Windows PowerShell\n\n# Install dependencies\npip install -r backend/requirements.txt\n</code></pre>"},{"location":"#step-2-start-postgresql","title":"Step 2: Start PostgreSQL","text":"<pre><code># Run Postgres container (persistent volume)\ndocker run -d --name kycc-postgres `\n  -e POSTGRES_USER=kycc_user `\n  -e POSTGRES_PASSWORD=kycc_pass `\n  -e POSTGRES_DB=kycc_db `\n  -p 5433:5432 `\n  -v kycc_pgdata:/var/lib/postgresql/data `\n  postgres:15\n\n# Verify ready\ndocker exec kycc-postgres pg_isready -U kycc_user -d kycc_db\n</code></pre>"},{"location":"#step-3-configure-env","title":"Step 3: Configure <code>.env</code>","text":"<pre><code># backend/.env\nDATABASE_URL=postgresql://kycc_user:kycc_pass@localhost:5433/kycc_db\nDEV_DATABASE_URL=sqlite:///./dev.db\nAUTO_CREATE_TABLES=1\nFORCE_SQLITE_FALLBACK=0\n</code></pre>"},{"location":"#step-4-run-api-server","title":"Step 4: Run API Server","text":"<pre><code>cd backend\npython -m uvicorn main:app --reload --port 8001\n\n# API available at:\n# - http://localhost:8001\n# - API docs: http://localhost:8001/docs\n# - ReDoc: http://localhost:8001/redoc\n</code></pre>"},{"location":"#step-5-run-frontend-optional","title":"Step 5: Run Frontend (Optional)","text":"<p>Option A: React (esbuild) <pre><code>cd frontend\nnpm install &amp;&amp; npm run dev\n# Open http://localhost:5173\n</code></pre></p> <p>Option B: Streamlit (Lightweight) <pre><code>cd frontend\npython -m streamlit run streamlit_app.py\n# Opens automatically in browser\n</code></pre></p>"},{"location":"#troubleshooting","title":"Troubleshooting","text":""},{"location":"#modulenotfounderror-no-module-named-app","title":"\"ModuleNotFoundError: No module named 'app'\"","text":"<p>Solution: Ensure <code>backend/__init__.py</code> exists (makes backend a package).</p>"},{"location":"#postgres-connection-error","title":"Postgres Connection Error","text":"<p>Solution: 1. Verify container running: <code>docker ps</code> 2. Check credentials in <code>.env</code> match Docker setup 3. Set <code>FORCE_SQLITE_FALLBACK=1</code> to use SQLite instead</p>"},{"location":"#score-seems-wrong","title":"Score Seems Wrong","text":"<p>Debug: 1. Call <code>GET /api/scoring/features/{party_id}</code> to see extracted features 2. Check <code>model_registry</code> table for correct weights 3. Review <code>score_requests</code> audit log entry for <code>features_snapshot</code></p>"},{"location":"#design-principles","title":"Design Principles","text":"<p>\u2705 Modular: Extractors are pluggable (add new ones without touching scoring logic)</p> <p>\u2705 Auditable: Every computation logged with full feature snapshot + model version</p> <p>\u2705 Interpretable: Linear scorecard explains which factors matter most</p> <p>\u2705 Extensible: ML model support via <code>model_registry</code> (plug in any model)</p> <p>\u2705 Robust: Fallback from Postgres to SQLite, error handling in extractors</p> <p>\u2705 Scalable: Stateless API (can run multiple instances), database-backed persistence</p>"},{"location":"#next-steps-future-work","title":"Next Steps &amp; Future Work","text":"<ul> <li> Add Alembic migrations for schema versioning</li> <li> Implement ML scoring option (XGBoost, Neural Network) in model_registry</li> <li> Add data validation rules for incoming transactions</li> <li> Build admin dashboard for model/rule management</li> <li> Add webhooks for score change notifications</li> <li> Implement feature importance explainability (SHAP values)</li> <li> Add API rate limiting and authentication (OAuth2)</li> <li> Deploy to cloud (AWS ECS, GCP Cloud Run, Azure Container Instances)</li> </ul>"},{"location":"architecture/","title":"System Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>KYCC follows a modular, service-oriented architecture with clear separation of concerns across the data flow pipeline.</p>"},{"location":"architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Frontend Layer                       \u2502\n\u2502  React + Vite \u2502 Streamlit \u2502 API Clients                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193 HTTP/REST\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      API Gateway Layer                      \u2502\n\u2502         FastAPI Routers (CORS, Validation, Auth)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Service Layer                          \u2502\n\u2502  ScoringService \u2502 FeaturePipelineService \u2502 NetworkService  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Extractor Layer                          \u2502\n\u2502  KYC \u2502 Transaction \u2502 Network \u2502 [Future Extractors]         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Data Access Layer                        \u2502\n\u2502           SQLAlchemy ORM + Session Management               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Database Layer                          \u2502\n\u2502         PostgreSQL 15 (Primary) \u2502 SQLite (Fallback)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#component-breakdown","title":"Component Breakdown","text":""},{"location":"architecture/#api-layer-backendappapi","title":"API Layer (<code>backend/app/api/</code>)","text":"<p>Purpose: HTTP endpoint handlers with validation</p> <p>Components: - <code>parties.py</code> - Party CRUD operations - <code>relationships.py</code> - Relationship management - <code>scoring.py</code> - Legacy scoring endpoints - <code>scoring_v2.py</code> - Enhanced scoring with caching - <code>synthetic.py</code> - Test data generation</p> <p>Responsibilities: - Request validation (Pydantic) - Response serialization - Error handling - Database session injection</p>"},{"location":"architecture/#service-layer-backendappservices","title":"Service Layer (<code>backend/app/services/</code>)","text":"<p>Purpose: Business logic orchestration</p> <p>Components: - <code>scoring_service.py</code> - Credit score computation - <code>feature_pipeline_service.py</code> - Feature extraction orchestration - <code>scorecard_service.py</code> - Scorecard model management - <code>network_service.py</code> - Graph traversal algorithms - <code>synthetic_seed_service.py</code> - Test data ingestion</p> <p>Responsibilities: - Coordinate extractors - Apply business rules - Manage scoring models - Audit logging</p>"},{"location":"architecture/#extractor-layer-backendappextractors","title":"Extractor Layer (<code>backend/app/extractors/</code>)","text":"<p>Purpose: Feature extraction from raw data</p> <p>Components: - <code>base_extractor.py</code> - Abstract base class - <code>kyc_extractor.py</code> - KYC compliance features - <code>transaction_extractor.py</code> - Transaction patterns - <code>network_extractor.py</code> - Supply chain graph metrics</p> <p>Responsibilities: - Compute features from raw data - Handle missing data gracefully - Tag features with metadata - Return normalized results</p>"},{"location":"architecture/#data-models-backendappmodels","title":"Data Models (<code>backend/app/models/</code>)","text":"<p>Purpose: Database schema definitions</p> <p>Key Models: - <code>Party</code> - Companies in supply chain - <code>Relationship</code> - Supply chain connections - <code>Transaction</code> - Payment/shipment history - <code>Feature</code> - Extracted signals (versioned) - <code>ScoreRequest</code> - Audit log - <code>ModelRegistry</code> - Scoring models - <code>DecisionRule</code> - Business rules</p>"},{"location":"architecture/#adapters-backendappadapters","title":"Adapters (<code>backend/app/adapters/</code>)","text":"<p>Purpose: Normalize external data sources</p> <p>Components: - <code>base.py</code> - Adapter interface - <code>synthetic_adapter.py</code> - Test data adapter - <code>registry.py</code> - Adapter registration</p> <p>Pattern: Transform heterogeneous input \u2192 standardized Party schema</p>"},{"location":"architecture/#rules-engine-backendapprules","title":"Rules Engine (<code>backend/app/rules/</code>)","text":"<p>Purpose: Evaluate decision rules on features</p> <p>Components: - <code>evaluator.py</code> - Safe expression evaluation - <code>schema.py</code> - Rule validation schemas</p> <p>Capabilities: - Python expression evaluation - Priority-based rule matching - Safe execution (no <code>eval</code> risks)</p>"},{"location":"architecture/#cache-layer-backendappcache","title":"Cache Layer (<code>backend/app/cache/</code>)","text":"<p>Purpose: In-memory feature caching</p> <p>Components: - <code>ttl_cache.py</code> - TTL-based cache - <code>cache_key.py</code> - Key generation</p> <p>Features: - 5-minute TTL - Thread-safe operations - Automatic expiration</p>"},{"location":"architecture/#data-flow-score-computation","title":"Data Flow: Score Computation","text":"<pre><code>1. API Request (POST /api/scoring/score/1)\n        \u2193\n2. ScoringService.compute_score(party_id=1)\n        \u2193\n3. Check cache for features (miss)\n        \u2193\n4. FeaturePipelineService.extract_all_features()\n        \u2193\n5. Parallel extractor execution:\n   - KYCExtractor \u2192 4 features\n   - TransactionExtractor \u2192 4 features\n   - NetworkExtractor \u2192 3 features\n        \u2193\n6. Store features in DB (versioned)\n        \u2193\n7. Cache features (5 min TTL)\n        \u2193\n8. Fetch active scorecard model\n        \u2193\n9. Normalize features (0-1 scale)\n        \u2193\n10. Apply weighted scorecard formula\n        \u2193\n11. Scale to 300-900 range\n        \u2193\n12. Evaluate decision rules (priority order)\n        \u2193\n13. Create ScoreRequest audit log\n        \u2193\n14. Return ScoreResponse (JSON)\n</code></pre>"},{"location":"architecture/#design-patterns","title":"Design Patterns","text":""},{"location":"architecture/#extractor-pattern","title":"Extractor Pattern","text":"<p>All extractors inherit <code>BaseFeatureExtractor</code>: <pre><code>class BaseFeatureExtractor(ABC):\n    @abstractmethod\n    def extract(self, party_id: int, db: Session) -&gt; List[FeatureExtractorResult]\n\n    @abstractmethod\n    def get_source_type(self) -&gt; str\n</code></pre></p> <p>Benefits: - Pluggable extractors - Consistent interface - Easy to test in isolation</p>"},{"location":"architecture/#adapter-pattern","title":"Adapter Pattern","text":"<p>External data sources implement <code>BaseAdapter</code>: <pre><code>class BaseAdapter(ABC):\n    @abstractmethod\n    def parse(self, data: dict) -&gt; dict\n\n    @abstractmethod\n    def validate(self, data: dict) -&gt; bool\n</code></pre></p> <p>Benefits: - Normalize heterogeneous inputs - Swap data sources without changing logic - Easy to add new integrations</p>"},{"location":"architecture/#repository-pattern","title":"Repository Pattern","text":"<p>Database access through session dependency: <pre><code>def get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n@router.get(\"/api/parties/{id}\")\ndef get_party(id: int, db: Session = Depends(get_db)):\n    return db.query(Party).filter(Party.id == id).first()\n</code></pre></p> <p>Benefits: - Automatic session management - No session leaks - Testable (mock db dependency)</p>"},{"location":"architecture/#strategy-pattern","title":"Strategy Pattern","text":"<p>Scoring models are pluggable via <code>ModelRegistry</code>: <pre><code>model = db.query(ModelRegistry)\\\n    .filter(ModelRegistry.is_active == 1)\\\n    .first()\n\nif model.model_type == \"scorecard\":\n    score = apply_scorecard(features, model.weights)\nelif model.model_type == \"xgboost\":\n    score = apply_ml_model(features, model.model_config)\n</code></pre></p> <p>Benefits: - Swap scoring algorithms without code changes - A/B test models - Rollback to previous model versions</p>"},{"location":"architecture/#scalability-considerations","title":"Scalability Considerations","text":""},{"location":"architecture/#horizontal-scaling","title":"Horizontal Scaling","text":"<ul> <li>Stateless API: No in-memory state (except cache)</li> <li>Database pooling: Connection reuse</li> <li>Load balancer: Distribute requests across instances</li> </ul>"},{"location":"architecture/#caching-strategy","title":"Caching Strategy","text":"<ul> <li>Feature cache: Avoid recomputing expensive features</li> <li>TTL expiration: Balance freshness vs performance</li> <li>Cache invalidation: On feature updates</li> </ul>"},{"location":"architecture/#database-optimization","title":"Database Optimization","text":"<ul> <li>Indices: On <code>party_id</code>, <code>feature_name</code>, <code>valid_to</code></li> <li>Partitioning: By <code>request_timestamp</code> for audit logs</li> <li>Read replicas: Separate read/write workloads</li> </ul>"},{"location":"architecture/#async-processing","title":"Async Processing","text":"<ul> <li>Background tasks: Long-running feature extraction</li> <li>Message queue: Celery/RabbitMQ for batch scoring</li> <li>Webhooks: Notify on score changes</li> </ul>"},{"location":"architecture/#security-considerations","title":"Security Considerations","text":""},{"location":"architecture/#api-security","title":"API Security","text":"<ul> <li>CORS: Restricted origins</li> <li>Rate limiting: Prevent abuse</li> <li>Authentication: OAuth2/JWT (future)</li> <li>Input validation: Pydantic schemas</li> </ul>"},{"location":"architecture/#database-security","title":"Database Security","text":"<ul> <li>Prepared statements: SQLAlchemy ORM (no SQL injection)</li> <li>Encrypted connections: TLS for Postgres</li> <li>Credential management: Environment variables</li> </ul>"},{"location":"architecture/#rule-evaluation-safety","title":"Rule Evaluation Safety","text":"<ul> <li>No <code>eval()</code>: Use <code>simpleeval</code> library</li> <li>Restricted builtins: No file system access</li> <li>Expression timeout: Prevent infinite loops</li> </ul>"},{"location":"architecture/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"architecture/#logging","title":"Logging","text":"<ul> <li>Structured logs: JSON format</li> <li>Log levels: DEBUG, INFO, WARNING, ERROR</li> <li>Request IDs: Trace requests across services</li> </ul>"},{"location":"architecture/#metrics","title":"Metrics","text":"<ul> <li>Response times: Per endpoint</li> <li>Error rates: 4xx/5xx counts</li> <li>Feature extraction latency: Per extractor</li> <li>Cache hit rate: Feature cache effectiveness</li> </ul>"},{"location":"architecture/#tracing","title":"Tracing","text":"<ul> <li>Distributed tracing: OpenTelemetry (future)</li> <li>Database query profiling: Slow query logs</li> <li>Audit logs: All score computations</li> </ul>"},{"location":"architecture/#technology-stack","title":"Technology Stack","text":"Component Technology Reason API Framework FastAPI Async, type hints, auto-generated docs ORM SQLAlchemy 2.x Modern async, relationships, migrations Database PostgreSQL 15 JSON support, recursive CTEs, ACID Validation Pydantic v2 Type safety, ORM mode, performance Frontend React + Vite Fast HMR, component-based, modern Alternate UI Streamlit Rapid prototyping, data apps Caching In-memory dict Simple, thread-safe, TTL-based Testing pytest Fixtures, parametrization, coverage Containerization Docker Portable, isolated, reproducible"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#quick-start-guide","title":"Quick Start Guide","text":"<p>This guide will help you get KYCC up and running on your local machine.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.11+</li> <li>Docker Desktop (for PostgreSQL)</li> <li>Node.js 18+ (optional, for React frontend)</li> <li>Git</li> </ul>"},{"location":"getting-started/#installation-steps","title":"Installation Steps","text":""},{"location":"getting-started/#1-clone-repository","title":"1. Clone Repository","text":"<pre><code>git clone https://github.com/kzauha/KYCC.git\ncd KYCC\n</code></pre>"},{"location":"getting-started/#2-set-up-python-environment","title":"2. Set Up Python Environment","text":"<pre><code># Create virtual environment\npython -m venv venv\n\n# Activate (Windows PowerShell)\nvenv\\Scripts\\Activate.ps1\n\n# Activate (Windows Git Bash)\nsource venv/Scripts/activate\n\n# Install backend dependencies\npip install -r backend/requirements.txt\n</code></pre>"},{"location":"getting-started/#3-start-postgresql-database","title":"3. Start PostgreSQL Database","text":"<pre><code>docker run -d --name kycc-postgres \\\n  -e POSTGRES_USER=kycc_user \\\n  -e POSTGRES_PASSWORD=kycc_pass \\\n  -e POSTGRES_DB=kycc_db \\\n  -p 5433:5432 \\\n  -v kycc_pgdata:/var/lib/postgresql/data \\\n  postgres:15\n\n# Verify it's running\ndocker exec kycc-postgres pg_isready -U kycc_user -d kycc_db\n</code></pre>"},{"location":"getting-started/#4-configure-environment","title":"4. Configure Environment","text":"<p>Create <code>backend/.env</code>:</p> <pre><code>DATABASE_URL=postgresql://kycc_user:kycc_pass@localhost:5433/kycc_db\nDEV_DATABASE_URL=sqlite:///./dev.db\nAUTO_CREATE_TABLES=1\nFORCE_SQLITE_FALLBACK=0\n</code></pre>"},{"location":"getting-started/#5-start-backend-api","title":"5. Start Backend API","text":"<pre><code>cd backend\npython -m uvicorn main:app --reload --port 8000\n\n# API will be available at:\n# http://localhost:8000/docs (Swagger UI)\n# http://localhost:8000/redoc (ReDoc)\n</code></pre>"},{"location":"getting-started/#6-start-frontend-optional","title":"6. Start Frontend (Optional)","text":"<pre><code>cd frontend\nnpm install\nnpm run dev\n\n# Frontend available at http://localhost:5173\n</code></pre>"},{"location":"getting-started/#using-the-quick-start-script","title":"Using the Quick Start Script","text":"<p>For automated setup, use the PowerShell script:</p> <pre><code>.\\run_all.ps1\n</code></pre> <p>This script will: - Find available ports automatically - Start backend and frontend servers - Monitor logs in real-time - Handle port conflicts gracefully</p>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<ol> <li>Open http://localhost:8000/health - Should return <code>{\"status\":\"healthy\"}</code></li> <li>Open http://localhost:8000/docs - Should show interactive API documentation</li> <li>Open http://localhost:5173 (if running frontend) - Should show KYCC web interface</li> </ol>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture Overview - Understand the system design</li> <li>API Reference - Explore available endpoints</li> <li>Database Schema - Learn the data model</li> <li>Scoring Guide - How credit scoring works</li> </ul>"},{"location":"getting-started/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/#python-not-found","title":"Python Not Found","text":"<p>Ensure Python is added to your PATH during installation.</p>"},{"location":"getting-started/#port-already-in-use","title":"Port Already in Use","text":"<p>The <code>run_all.ps1</code> script auto-detects conflicts. Manually specify ports: <pre><code>python -m uvicorn main:app --port 8001\n</code></pre></p>"},{"location":"getting-started/#database-connection-failed","title":"Database Connection Failed","text":"<p>Check if PostgreSQL container is running: <pre><code>docker ps\ndocker logs kycc-postgres\n</code></pre></p> <p>Set <code>FORCE_SQLITE_FALLBACK=1</code> in <code>.env</code> to use SQLite instead.</p>"},{"location":"api/overview/","title":"API Overview","text":""},{"location":"api/overview/#base-url","title":"Base URL","text":"<p>Local Development: <code>http://localhost:8000</code></p> <p>API Documentation: - Swagger UI: <code>http://localhost:8000/docs</code> - ReDoc: <code>http://localhost:8000/redoc</code></p>"},{"location":"api/overview/#api-routers","title":"API Routers","text":"<p>KYCC exposes 23 endpoints across 5 routers:</p> Router Base Path Purpose Endpoints Parties <code>/api/parties</code> Party CRUD operations 7 Relationships <code>/api/relationships</code> Relationship management 3 Scoring <code>/api/scoring</code> Credit score computation 5 Scoring V2 <code>/api/v2/scoring</code> Enhanced scoring with caching 3 Synthetic <code>/api/synthetic</code> Test data generation 5"},{"location":"api/overview/#authentication","title":"Authentication","text":"<p>Currently no authentication required (development mode). Production should implement: - OAuth2 with JWT tokens - API key-based authentication - Rate limiting per client</p>"},{"location":"api/overview/#requestresponse-format","title":"Request/Response Format","text":"<p>All requests and responses use <code>Content-Type: application/json</code>.</p>"},{"location":"api/overview/#success-response","title":"Success Response","text":"<pre><code>{\n  \"id\": 1,\n  \"party_name\": \"ACME Corp\",\n  \"status\": \"success\"\n}\n</code></pre>"},{"location":"api/overview/#error-response","title":"Error Response","text":"<pre><code>{\n  \"detail\": \"Party not found\",\n  \"status_code\": 404\n}\n</code></pre>"},{"location":"api/overview/#common-http-status-codes","title":"Common HTTP Status Codes","text":"Code Meaning When Used 200 OK Successful GET/PUT request 201 Created Successful POST (resource created) 204 No Content Successful DELETE 400 Bad Request Invalid input data 404 Not Found Resource doesn't exist 422 Unprocessable Entity Validation error 500 Internal Server Error Server-side error"},{"location":"api/overview/#pagination","title":"Pagination","text":"<p>List endpoints support pagination:</p> <pre><code>GET /api/parties?skip=0&amp;limit=10\n</code></pre> <p>Parameters: - <code>skip</code> (int): Number of records to skip (default: 0) - <code>limit</code> (int): Maximum records to return (default: 100, max: 1000)</p>"},{"location":"api/overview/#filtering","title":"Filtering","text":"<p>Some endpoints support query parameters:</p> <pre><code>GET /api/parties?party_type=supplier&amp;kyc_verified__gte=80\n</code></pre>"},{"location":"api/overview/#rate-limiting","title":"Rate Limiting","text":"<p>Not currently implemented. Recommended for production: - 100 requests per minute per IP - 1000 requests per hour per API key</p>"},{"location":"api/overview/#cors-configuration","title":"CORS Configuration","text":"<p>CORS is enabled for local development: - Allowed origins: <code>http://localhost:5173</code>, <code>http://localhost:3000</code> - Allowed methods: GET, POST, PUT, DELETE, PATCH - Allowed headers: <code>*</code></p>"},{"location":"api/overview/#endpoints-by-category","title":"Endpoints by Category","text":""},{"location":"api/overview/#party-management","title":"Party Management","text":"<ul> <li>Parties API - CRUD for supply chain companies</li> </ul>"},{"location":"api/overview/#credit-scoring","title":"Credit Scoring","text":"<ul> <li>Scoring API - Compute credit scores</li> </ul>"},{"location":"api/overview/#testing-development","title":"Testing &amp; Development","text":"<ul> <li>Synthetic API - Generate test data (see Swagger UI at <code>/docs</code>)</li> <li>Health Check - System health monitoring (see <code>/health</code> endpoint)</li> </ul>"},{"location":"api/overview/#api-versioning","title":"API Versioning","text":"<p>Current version: <code>v1</code> (implicit)</p> <p>Future versions will use explicit URL versioning: - <code>/api/v1/parties</code> - <code>/api/v2/parties</code></p>"},{"location":"api/overview/#websockets","title":"WebSockets","text":"<p>Not currently implemented. Planned for: - Real-time score updates - Live transaction monitoring - Network graph streaming</p>"},{"location":"api/overview/#graphql","title":"GraphQL","text":"<p>Not currently implemented. REST API is preferred for now.</p>"},{"location":"api/overview/#sdks-client-libraries","title":"SDKs &amp; Client Libraries","text":""},{"location":"api/overview/#python","title":"Python","text":"<pre><code>import requests\n\nresponse = requests.get(\"http://localhost:8000/api/parties/1\")\nparty = response.json()\n</code></pre>"},{"location":"api/overview/#javascript","title":"JavaScript","text":"<pre><code>const response = await fetch('http://localhost:8000/api/parties/1');\nconst party = await response.json();\n</code></pre>"},{"location":"api/overview/#curl","title":"cURL","text":"<pre><code>curl -X GET \"http://localhost:8000/api/parties/1\" \\\n  -H \"Content-Type: application/json\"\n</code></pre>"},{"location":"api/overview/#api-testing","title":"API Testing","text":"<p>Use the interactive Swagger UI at <code>/docs</code> to: - Explore endpoints - Test requests - View response schemas - Generate code snippets</p>"},{"location":"api/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Parties API Reference</li> <li>Scoring API Reference</li> <li>Interactive API Documentation - Swagger UI</li> </ul>"},{"location":"api/parties/","title":"Parties API","text":"<p>Manage supply chain parties (companies) including suppliers, manufacturers, distributors, and retailers.</p>"},{"location":"api/parties/#endpoints","title":"Endpoints","text":""},{"location":"api/parties/#create-party","title":"Create Party","text":"<pre><code>POST /api/parties/\n</code></pre> <p>Create a new party in the system.</p> <p>Request Body: <pre><code>{\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"party_type\": \"supplier\",\n  \"kyc_verified\": 85,\n  \"tax_id\": \"12-3456789\",\n  \"address\": \"123 Main St, City, State 12345\",\n  \"contact_person\": \"John Doe\",\n  \"email\": \"john@acme.com\",\n  \"phone\": \"+1-555-0100\"\n}\n</code></pre></p> <p>Response (201 Created): <pre><code>{\n  \"id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"party_type\": \"supplier\",\n  \"kyc_verified\": 85,\n  \"created_at\": \"2025-12-15T10:30:00Z\",\n  \"updated_at\": \"2025-12-15T10:30:00Z\"\n}\n</code></pre></p>"},{"location":"api/parties/#list-parties","title":"List Parties","text":"<pre><code>GET /api/parties?skip=0&amp;limit=100&amp;party_type=supplier\n</code></pre> <p>Retrieve a list of parties with optional filtering.</p> <p>Query Parameters: - <code>skip</code> (int): Records to skip for pagination (default: 0) - <code>limit</code> (int): Maximum records to return (default: 100) - <code>party_type</code> (string): Filter by type: <code>supplier</code>, <code>manufacturer</code>, <code>distributor</code>, <code>retailer</code>, <code>customer</code></p> <p>Response (200 OK): <pre><code>[\n  {\n    \"id\": 1,\n    \"party_name\": \"ACME Suppliers Inc\",\n    \"party_type\": \"supplier\",\n    \"kyc_verified\": 85,\n    \"created_at\": \"2025-12-15T10:30:00Z\"\n  },\n  {\n    \"id\": 2,\n    \"party_name\": \"Global Manufacturing Co\",\n    \"party_type\": \"manufacturer\",\n    \"kyc_verified\": 92,\n    \"created_at\": \"2025-12-14T08:15:00Z\"\n  }\n]\n</code></pre></p>"},{"location":"api/parties/#get-party-by-id","title":"Get Party by ID","text":"<pre><code>GET /api/parties/{party_id}\n</code></pre> <p>Retrieve a single party by ID.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Response (200 OK): <pre><code>{\n  \"id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"party_type\": \"supplier\",\n  \"kyc_verified\": 85,\n  \"tax_id\": \"12-3456789\",\n  \"address\": \"123 Main St, City, State 12345\",\n  \"contact_person\": \"John Doe\",\n  \"email\": \"john@acme.com\",\n  \"phone\": \"+1-555-0100\",\n  \"created_at\": \"2025-12-15T10:30:00Z\",\n  \"updated_at\": \"2025-12-15T10:30:00Z\"\n}\n</code></pre></p> <p>Error (404 Not Found): <pre><code>{\n  \"detail\": \"Party not found\"\n}\n</code></pre></p>"},{"location":"api/parties/#update-party","title":"Update Party","text":"<pre><code>PUT /api/parties/{party_id}\n</code></pre> <p>Update an existing party.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Request Body: <pre><code>{\n  \"party_name\": \"ACME Suppliers Inc (Updated)\",\n  \"kyc_verified\": 90,\n  \"email\": \"newemail@acme.com\"\n}\n</code></pre></p> <p>Response (200 OK): <pre><code>{\n  \"id\": 1,\n  \"party_name\": \"ACME Suppliers Inc (Updated)\",\n  \"kyc_verified\": 90,\n  \"email\": \"newemail@acme.com\",\n  \"updated_at\": \"2025-12-15T11:00:00Z\"\n}\n</code></pre></p>"},{"location":"api/parties/#delete-party","title":"Delete Party","text":"<pre><code>DELETE /api/parties/{party_id}\n</code></pre> <p>Delete a party from the system.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Response (204 No Content)</p>"},{"location":"api/parties/#get-party-network","title":"Get Party Network","text":"<pre><code>GET /api/parties/{party_id}/network\n</code></pre> <p>Retrieve the full supply chain network for a party (upstream and downstream).</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"upstream\": [\n    {\n      \"id\": 5,\n      \"party_name\": \"Raw Materials Corp\",\n      \"relationship_type\": \"supplies_to\"\n    }\n  ],\n  \"downstream\": [\n    {\n      \"id\": 2,\n      \"party_name\": \"Global Manufacturing Co\",\n      \"relationship_type\": \"supplies_to\"\n    }\n  ],\n  \"network_size\": 3,\n  \"network_depth\": 2\n}\n</code></pre></p>"},{"location":"api/parties/#get-party-counterparties","title":"Get Party Counterparties","text":"<pre><code>GET /api/parties/{party_id}/counterparties\n</code></pre> <p>Retrieve direct counterparties (suppliers and customers) for a party.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"suppliers\": [\n    {\n      \"id\": 5,\n      \"party_name\": \"Raw Materials Corp\",\n      \"relationship_type\": \"supplies_to\"\n    }\n  ],\n  \"customers\": [\n    {\n      \"id\": 2,\n      \"party_name\": \"Global Manufacturing Co\",\n      \"relationship_type\": \"supplies_to\"\n    }\n  ],\n  \"total_suppliers\": 1,\n  \"total_customers\": 1\n}\n</code></pre></p>"},{"location":"api/parties/#party-types","title":"Party Types","text":"<p>Valid <code>party_type</code> values:</p> Type Description <code>supplier</code> Provides raw materials or components <code>manufacturer</code> Produces finished goods <code>distributor</code> Handles wholesale distribution <code>retailer</code> Sells to end consumers <code>customer</code> End customer or buyer"},{"location":"api/parties/#kyc-score","title":"KYC Score","text":"<p><code>kyc_verified</code> is an integer between 0-100 representing: - 0-39: Poor compliance (high risk) - 40-69: Fair compliance (medium risk) - 70-89: Good compliance (low risk) - 90-100: Excellent compliance (very low risk)</p>"},{"location":"api/parties/#validation-rules","title":"Validation Rules","text":"<ul> <li><code>party_name</code>: Required, 2-255 characters</li> <li><code>party_type</code>: Required, must be one of valid types</li> <li><code>kyc_verified</code>: Optional, 0-100 integer</li> <li><code>email</code>: Optional, valid email format</li> <li><code>tax_id</code>: Optional, string</li> </ul>"},{"location":"api/parties/#examples","title":"Examples","text":""},{"location":"api/parties/#create-a-supplier","title":"Create a Supplier","text":"<pre><code>import requests\n\nparty = {\n    \"party_name\": \"Tech Components Ltd\",\n    \"party_type\": \"supplier\",\n    \"kyc_verified\": 88,\n    \"email\": \"contact@techcomponents.com\"\n}\n\nresponse = requests.post(\n    \"http://localhost:8000/api/parties/\",\n    json=party\n)\nprint(response.json())\n</code></pre>"},{"location":"api/parties/#filter-high-kyc-suppliers","title":"Filter High-KYC Suppliers","text":"<pre><code>response = requests.get(\n    \"http://localhost:8000/api/parties\",\n    params={\"party_type\": \"supplier\", \"limit\": 50}\n)\nparties = response.json()\nhigh_kyc = [p for p in parties if p[\"kyc_verified\"] &gt;= 80]\n</code></pre>"},{"location":"api/parties/#update-party-kyc-score","title":"Update Party KYC Score","text":"<pre><code>response = requests.put(\n    \"http://localhost:8000/api/parties/1\",\n    json={\"kyc_verified\": 95}\n)\n</code></pre>"},{"location":"api/scoring/","title":"Scoring API","text":"<p>Compute credit scores for parties using the KYCC scorecard model.</p>"},{"location":"api/scoring/#overview","title":"Overview","text":"<p>The Scoring API provides endpoints to: - Compute credit scores (300-900 range) - View scoring history - Extract features manually - View feature details</p>"},{"location":"api/scoring/#endpoints","title":"Endpoints","text":""},{"location":"api/scoring/#compute-credit-score","title":"Compute Credit Score","text":"<pre><code>POST /api/scoring/score/{party_id}\n</code></pre> <p>Compute a credit score for the specified party.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID to score</p> <p>Query Parameters: - <code>model_version</code> (string, optional): Specific model version to use (default: latest active) - <code>include_explanation</code> (bool, optional): Include feature contributions (default: true)</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"score\": 761,\n  \"score_band\": \"good\",\n  \"confidence\": 0.91,\n  \"decision\": \"APPROVE\",\n  \"decision_reasons\": [\n    \"Rule 4: Approve if final_score &gt; 750\"\n  ],\n  \"explanation\": {\n    \"top_positive_factors\": [\n      {\n        \"feature\": \"transaction_count\",\n        \"value\": 15.0,\n        \"contribution\": 0.1875,\n        \"weight\": 0.25\n      },\n      {\n        \"feature\": \"transaction_regularity\",\n        \"value\": 0.96,\n        \"contribution\": 0.144,\n        \"weight\": 0.15\n      },\n      {\n        \"feature\": \"kyc_score\",\n        \"value\": 85.0,\n        \"contribution\": 0.170,\n        \"weight\": 0.20\n      }\n    ],\n    \"top_negative_factors\": []\n  },\n  \"features_used\": 11,\n  \"features_total\": 11,\n  \"computed_at\": \"2025-12-15T10:31:00Z\",\n  \"model_version\": \"default_scorecard_v1\",\n  \"processing_time_ms\": 145\n}\n</code></pre></p>"},{"location":"api/scoring/#get-score-history","title":"Get Score History","text":"<pre><code>GET /api/scoring/score/{party_id}/history\n</code></pre> <p>Retrieve the scoring history for a party.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Query Parameters: - <code>limit</code> (int, optional): Maximum records to return (default: 10)</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"scores\": [\n    {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"score\": 761,\n      \"score_band\": \"good\",\n      \"decision\": \"APPROVE\",\n      \"confidence\": 0.91,\n      \"computed_at\": \"2025-12-15T10:31:00Z\",\n      \"model_version\": \"default_scorecard_v1\"\n    },\n    {\n      \"id\": \"660e8400-e29b-41d4-a716-446655440001\",\n      \"score\": 748,\n      \"score_band\": \"good\",\n      \"decision\": \"MANUAL_REVIEW\",\n      \"confidence\": 0.87,\n      \"computed_at\": \"2025-12-08T14:20:00Z\",\n      \"model_version\": \"default_scorecard_v1\"\n    }\n  ],\n  \"total_scores\": 2,\n  \"score_trend\": \"improving\",\n  \"avg_score\": 754.5\n}\n</code></pre></p>"},{"location":"api/scoring/#get-party-features","title":"Get Party Features","text":"<pre><code>GET /api/scoring/features/{party_id}\n</code></pre> <p>Retrieve all extracted features for a party.</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Query Parameters: - <code>source_type</code> (string, optional): Filter by source: <code>KYC</code>, <code>TRANSACTION</code>, <code>NETWORK</code> - <code>current_only</code> (bool, optional): Only show current features (default: true)</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"party_name\": \"ACME Suppliers Inc\",\n  \"features\": [\n    {\n      \"feature_name\": \"kyc_score\",\n      \"feature_value\": 85.0,\n      \"source_type\": \"KYC\",\n      \"confidence_score\": 1.0,\n      \"computed_at\": \"2025-12-15T10:30:00Z\",\n      \"valid_from\": \"2025-12-15T10:30:00Z\",\n      \"valid_to\": null\n    },\n    {\n      \"feature_name\": \"transaction_count\",\n      \"feature_value\": 15.0,\n      \"source_type\": \"TRANSACTION\",\n      \"confidence_score\": 1.0,\n      \"computed_at\": \"2025-12-15T10:30:00Z\",\n      \"valid_from\": \"2025-12-15T10:30:00Z\",\n      \"valid_to\": null\n    },\n    {\n      \"feature_name\": \"network_size\",\n      \"feature_value\": 2.0,\n      \"source_type\": \"NETWORK\",\n      \"confidence_score\": 1.0,\n      \"computed_at\": \"2025-12-15T10:30:00Z\",\n      \"valid_from\": \"2025-12-15T10:30:00Z\",\n      \"valid_to\": null\n    }\n  ],\n  \"feature_count\": 11,\n  \"last_computed\": \"2025-12-15T10:30:00Z\"\n}\n</code></pre></p>"},{"location":"api/scoring/#compute-features-manually","title":"Compute Features Manually","text":"<pre><code>POST /api/scoring/compute-features/{party_id}\n</code></pre> <p>Manually trigger feature extraction for a party (bypasses cache).</p> <p>Path Parameters: - <code>party_id</code> (int): The party ID</p> <p>Response (200 OK): <pre><code>{\n  \"party_id\": 1,\n  \"features_extracted\": 11,\n  \"sources\": [\"KYC\", \"TRANSACTION\", \"NETWORK\"],\n  \"computation_time_ms\": 87,\n  \"message\": \"Features extracted successfully\"\n}\n</code></pre></p>"},{"location":"api/scoring/#score-bands","title":"Score Bands","text":"<p>Credit scores are classified into bands:</p> Band Score Range Description Typical Decision Excellent 800-900 Very low risk Auto-approve Good 650-799 Low risk Approve with conditions Fair 550-649 Medium risk Manual review Poor 300-549 High risk Reject or require collateral"},{"location":"api/scoring/#decision-types","title":"Decision Types","text":"<p>Possible decision values:</p> Decision Meaning Next Steps <code>APPROVE</code> Automatically approved Proceed with transaction <code>REJECT</code> Automatically rejected Do not proceed <code>FLAG</code> Flagged for attention Review manually, may proceed with caution <code>MANUAL_REVIEW</code> Requires human review Hold transaction pending review"},{"location":"api/scoring/#feature-sources","title":"Feature Sources","text":"<p>Features are extracted from three sources:</p>"},{"location":"api/scoring/#kyc-features-4-features","title":"KYC Features (4 features)","text":"<ul> <li><code>kyc_score</code>: KYC verification score (0-100)</li> <li><code>company_age_days</code>: Days since party created</li> <li><code>party_type_encoded</code>: Numeric encoding of party type</li> <li><code>contact_completeness</code>: Percentage of contact fields filled</li> </ul>"},{"location":"api/scoring/#transaction-features-4-features","title":"Transaction Features (4 features)","text":"<ul> <li><code>transaction_count</code>: Total transaction count</li> <li><code>avg_transaction_amount</code>: Mean transaction value</li> <li><code>transaction_regularity</code>: Consistency of transactions (0-1)</li> <li><code>days_since_last_transaction</code>: Recency of activity</li> </ul>"},{"location":"api/scoring/#network-features-3-features","title":"Network Features (3 features)","text":"<ul> <li><code>network_size</code>: Total parties in supply chain component</li> <li><code>counterparty_count</code>: Direct suppliers + customers</li> <li><code>network_depth</code>: Maximum hops in relationship graph</li> </ul>"},{"location":"api/scoring/#scoring-algorithm","title":"Scoring Algorithm","text":"<ol> <li>Feature Extraction: Extract 11 features from 3 sources</li> <li>Normalization: Scale all features to 0-1 range</li> <li>Weighted Sum: Apply scorecard weights: <code>score = \u03a3(feature[i] \u00d7 weight[i])</code></li> <li>Scaling: Map 0-1 score to 300-900 range: <code>final = 300 + (score \u00d7 600)</code></li> <li>Banding: Assign score band based on thresholds</li> <li>Rules: Evaluate decision rules in priority order</li> <li>Audit: Log complete scoring record</li> </ol>"},{"location":"api/scoring/#confidence-score","title":"Confidence Score","text":"<p>Confidence indicates data completeness: - 1.0: All features available - 0.8-0.99: Most features available - 0.5-0.79: Partial feature set - &lt; 0.5: Insufficient data (score may be unreliable)</p>"},{"location":"api/scoring/#caching","title":"Caching","text":"<p>Features are cached for 5 minutes after extraction. To bypass cache: - Use <code>POST /api/scoring/compute-features/{party_id}</code> first - Or wait 5 minutes for TTL expiration</p>"},{"location":"api/scoring/#examples","title":"Examples","text":""},{"location":"api/scoring/#compute-score-with-explanation","title":"Compute Score with Explanation","text":"<pre><code>import requests\n\nresponse = requests.post(\n    \"http://localhost:8000/api/scoring/score/1\",\n    params={\"include_explanation\": True}\n)\nresult = response.json()\n\nprint(f\"Score: {result['score']}\")\nprint(f\"Decision: {result['decision']}\")\nprint(f\"Top factors: {result['explanation']['top_positive_factors']}\")\n</code></pre>"},{"location":"api/scoring/#get-recent-score-history","title":"Get Recent Score History","text":"<pre><code>response = requests.get(\n    \"http://localhost:8000/api/scoring/score/1/history\",\n    params={\"limit\": 5}\n)\nhistory = response.json()\n\nfor score in history['scores']:\n    print(f\"{score['computed_at']}: {score['score']} ({score['decision']})\")\n</code></pre>"},{"location":"api/scoring/#force-feature-recomputation","title":"Force Feature Recomputation","text":"<pre><code># First, recompute features\nrequests.post(\"http://localhost:8000/api/scoring/compute-features/1\")\n\n# Then, get fresh score\nresponse = requests.post(\"http://localhost:8000/api/scoring/score/1\")\nprint(response.json()['score'])\n</code></pre>"},{"location":"api/scoring/#error-handling","title":"Error Handling","text":""},{"location":"api/scoring/#party-not-found-404","title":"Party Not Found (404)","text":"<pre><code>{\n  \"detail\": \"Party with id 999 not found\"\n}\n</code></pre>"},{"location":"api/scoring/#insufficient-data-422","title":"Insufficient Data (422)","text":"<pre><code>{\n  \"detail\": \"Cannot compute score: no transactions found for party\",\n  \"party_id\": 1,\n  \"missing_sources\": [\"TRANSACTION\"]\n}\n</code></pre>"},{"location":"api/scoring/#model-not-found-500","title":"Model Not Found (500)","text":"<pre><code>{\n  \"detail\": \"No active scoring model found\",\n  \"suggestion\": \"Check model_registry table\"\n}\n</code></pre>"},{"location":"database/schema/","title":"Database Schema","text":""},{"location":"database/schema/#overview","title":"Overview","text":"<p>KYCC uses a relational database design with 14 tables organized into three logical groups:</p> <ol> <li>Core Supply Chain Data: Parties, Relationships, Transactions</li> <li>Scoring &amp; Features: Features, ScoreRequests, ModelRegistry, DecisionRules</li> <li>Metadata &amp; Configuration: BatchIngestion, FeatureDefinition, etc.</li> </ol>"},{"location":"database/schema/#entity-relationship-diagram","title":"Entity Relationship Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Party     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Relationship \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Party     \u2502\n\u2502             \u2502 from_id \u2502              \u2502 to_id   \u2502             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                                                 \u2502\n       \u2502                                                 \u2502\n       \u2502                                                 \u2502\n       \u25bc                                                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Transaction \u2502                                  \u2502   Feature   \u2502\n\u2502             \u2502                                  \u2502  (versioned)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                         \u2502\n                                                         \u2502\n                                                         \u25bc\n                                                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                                 \u2502 ScoreRequest \u2502\n                                                 \u2502  (audit log) \u2502\n                                                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"database/schema/#core-tables","title":"Core Tables","text":""},{"location":"database/schema/#parties","title":"parties","text":"<p>Supply chain actors (companies).</p> Column Type Constraints Description <code>id</code> INTEGER PRIMARY KEY Auto-increment ID <code>party_name</code> VARCHAR(255) NOT NULL Company name <code>party_type</code> VARCHAR(50) NOT NULL supplier, manufacturer, etc. <code>kyc_verified</code> INTEGER KYC score (0-100) <code>tax_id</code> VARCHAR(50) Tax identification number <code>address</code> TEXT Physical address <code>contact_person</code> VARCHAR(100) Primary contact name <code>email</code> VARCHAR(100) Contact email <code>phone</code> VARCHAR(20) Contact phone <code>created_at</code> TIMESTAMP DEFAULT NOW() Record creation time <code>updated_at</code> TIMESTAMP DEFAULT NOW() Last update time <p>Indices: - <code>idx_party_type</code> on <code>party_type</code> - <code>idx_kyc_verified</code> on <code>kyc_verified</code></p>"},{"location":"database/schema/#relationships","title":"relationships","text":"<p>Supply chain connections between parties.</p> Column Type Constraints Description <code>id</code> INTEGER PRIMARY KEY Auto-increment ID <code>from_party_id</code> INTEGER FK \u2192 parties(id) Source party <code>to_party_id</code> INTEGER FK \u2192 parties(id) Destination party <code>relationship_type</code> VARCHAR(50) NOT NULL supplies_to, distributes_to <code>created_at</code> TIMESTAMP DEFAULT NOW() Record creation time <p>Indices: - <code>idx_from_party</code> on <code>from_party_id</code> - <code>idx_to_party</code> on <code>to_party_id</code> - <code>idx_relationship_type</code> on <code>relationship_type</code></p> <p>Constraints: - CHECK: <code>from_party_id != to_party_id</code> (no self-loops)</p>"},{"location":"database/schema/#transactions","title":"transactions","text":"<p>Payment or shipment history between parties.</p> Column Type Constraints Description <code>id</code> INTEGER PRIMARY KEY Auto-increment ID <code>from_party_id</code> INTEGER FK \u2192 parties(id) Payer/shipper <code>to_party_id</code> INTEGER FK \u2192 parties(id) Payee/receiver <code>amount</code> DECIMAL(15,2) NOT NULL Transaction value <code>transaction_date</code> TIMESTAMP NOT NULL When transaction occurred <code>payment_type</code> VARCHAR(50) Cash, wire, crypto, etc. <code>created_at</code> TIMESTAMP DEFAULT NOW() Record creation time <p>Indices: - <code>idx_from_party_txn</code> on <code>from_party_id</code> - <code>idx_to_party_txn</code> on <code>to_party_id</code> - <code>idx_transaction_date</code> on <code>transaction_date</code></p>"},{"location":"database/schema/#scoring-tables","title":"Scoring Tables","text":""},{"location":"database/schema/#features","title":"features","text":"<p>Extracted features for credit scoring (versioned for audit).</p> Column Type Constraints Description <code>id</code> INTEGER PRIMARY KEY Auto-increment ID <code>party_id</code> INTEGER FK \u2192 parties(id) Party being scored <code>feature_name</code> VARCHAR(100) NOT NULL kyc_score, transaction_count, etc. <code>feature_value</code> DECIMAL(15,4) NOT NULL Numerical value <code>confidence_score</code> DECIMAL(5,4) Extractor confidence (0-1) <code>source_type</code> VARCHAR(50) KYC, TRANSACTION, NETWORK <code>computation_timestamp</code> TIMESTAMP DEFAULT NOW() When computed <code>valid_from</code> TIMESTAMP NOT NULL Start of validity <code>valid_to</code> TIMESTAMP End of validity (NULL = current) <p>Indices: - <code>idx_feature_lookup</code> on <code>(party_id, feature_name, valid_to)</code> - <code>idx_source_type</code> on <code>source_type</code></p> <p>Temporal Queries: <pre><code>-- Current features\nSELECT * FROM features\nWHERE party_id = 1 AND valid_to IS NULL;\n\n-- Historical features at specific time\nSELECT * FROM features\nWHERE party_id = 1\n  AND valid_from &lt;= '2025-12-01'\n  AND (valid_to IS NULL OR valid_to &gt; '2025-12-01');\n</code></pre></p>"},{"location":"database/schema/#score_requests","title":"score_requests","text":"<p>Complete audit log of all score computations.</p> Column Type Constraints Description <code>id</code> VARCHAR(36) PRIMARY KEY UUID <code>party_id</code> INTEGER FK \u2192 parties(id) Party scored <code>request_timestamp</code> TIMESTAMP NOT NULL When score computed <code>model_version</code> VARCHAR(50) NOT NULL Scorecard version used <code>model_type</code> VARCHAR(50) NOT NULL scorecard, xgboost, etc. <code>features_snapshot</code> JSON NOT NULL All features at scoring time <code>raw_score</code> DECIMAL(10,8) NOT NULL 0-1 range score <code>final_score</code> INTEGER NOT NULL 300-900 range score <code>score_band</code> VARCHAR(20) NOT NULL excellent, good, fair, poor <code>confidence_level</code> DECIMAL(5,4) NOT NULL Feature completeness <code>decision</code> VARCHAR(50) NOT NULL approve, reject, flag, review <code>decision_reasons</code> JSON Rule names that matched <code>processing_time_ms</code> INTEGER Computation latency <p>Indices: - <code>idx_score_party</code> on <code>party_id</code> - <code>idx_score_timestamp</code> on <code>request_timestamp DESC</code> - <code>idx_score_band</code> on <code>score_band</code></p>"},{"location":"database/schema/#model_registry","title":"model_registry","text":"<p>Scoring model repository (versioned).</p> Column Type Constraints Description <code>model_version</code> VARCHAR(50) PRIMARY KEY e.g., \"default_scorecard_v1\" <code>model_type</code> VARCHAR(50) NOT NULL scorecard, xgboost, neural_net <code>model_config</code> JSON NOT NULL Weights, hyperparams, etc. <code>feature_list</code> JSON NOT NULL Required feature names <code>intercept</code> DECIMAL(10,4) Scorecard intercept <code>normalization_method</code> VARCHAR(50) min-max, z-score, etc. <code>training_date</code> TIMESTAMP When model trained <code>deployed_date</code> TIMESTAMP NOT NULL When deployed to production <code>is_active</code> INTEGER NOT NULL 0=inactive, 1=active <code>performance_metrics</code> JSON AUC, precision, recall, etc. <code>description</code> TEXT Model notes <code>created_by</code> VARCHAR(100) Model creator <p>Constraints: - Only one model can have <code>is_active = 1</code> at a time</p>"},{"location":"database/schema/#decision_rules","title":"decision_rules","text":"<p>Business rules for score-based decisions.</p> Column Type Constraints Description <code>rule_id</code> VARCHAR(50) PRIMARY KEY e.g., \"RULE_001\" <code>rule_name</code> VARCHAR(255) NOT NULL Descriptive name <code>condition_expression</code> TEXT NOT NULL Python expression <code>action</code> VARCHAR(50) NOT NULL approve, reject, flag, review <code>priority</code> INTEGER NOT NULL Lower = higher priority <code>is_active</code> INTEGER NOT NULL 0=disabled, 1=enabled <code>created_at</code> TIMESTAMP DEFAULT NOW() <code>updated_at</code> TIMESTAMP DEFAULT NOW() <p>Constraints: - UNIQUE on <code>priority</code> (no duplicate priorities)</p>"},{"location":"database/schema/#supporting-tables","title":"Supporting Tables","text":""},{"location":"database/schema/#batch_ingestion","title":"batch_ingestion","text":"<p>Track bulk data imports.</p> Column Type Constraints Description <code>batch_id</code> VARCHAR(50) PRIMARY KEY Unique batch identifier <code>source_type</code> VARCHAR(50) NOT NULL synthetic, csv, api, etc. <code>records_processed</code> INTEGER Count of records imported <code>records_failed</code> INTEGER Count of failures <code>ingestion_timestamp</code> TIMESTAMP DEFAULT NOW() When batch ran <code>metadata</code> JSON Additional batch info"},{"location":"database/schema/#feature_definitions","title":"feature_definitions","text":"<p>Metadata about available features.</p> Column Type Constraints Description <code>feature_name</code> VARCHAR(100) PRIMARY KEY kyc_score, etc. <code>feature_type</code> VARCHAR(50) NOT NULL numeric, categorical, boolean <code>source_type</code> VARCHAR(50) NOT NULL KYC, TRANSACTION, NETWORK <code>description</code> TEXT Human-readable description <code>min_value</code> DECIMAL(15,4) Minimum expected value <code>max_value</code> DECIMAL(15,4) Maximum expected value <code>default_weight</code> DECIMAL(5,4) Default scorecard weight <code>is_required</code> INTEGER NOT NULL 0=optional, 1=required"},{"location":"database/schema/#data-types","title":"Data Types","text":""},{"location":"database/schema/#party_type-values","title":"party_type Values","text":"<ul> <li><code>supplier</code> - Raw material/component provider</li> <li><code>manufacturer</code> - Goods producer</li> <li><code>distributor</code> - Wholesale distribution</li> <li><code>retailer</code> - Retail sales</li> <li><code>customer</code> - End consumer</li> </ul>"},{"location":"database/schema/#relationship_type-values","title":"relationship_type Values","text":"<ul> <li><code>supplies_to</code> - A supplies B</li> <li><code>distributes_to</code> - A distributes for B</li> <li><code>manufactures_for</code> - A manufactures for B</li> <li><code>sells_to</code> - A sells to B</li> </ul>"},{"location":"database/schema/#payment_type-values","title":"payment_type Values","text":"<ul> <li><code>cash</code></li> <li><code>wire_transfer</code></li> <li><code>check</code></li> <li><code>crypto</code></li> <li><code>credit</code></li> <li><code>trade_credit</code></li> </ul>"},{"location":"database/schema/#source_type-values-features","title":"source_type Values (Features)","text":"<ul> <li><code>KYC</code> - From party compliance data</li> <li><code>TRANSACTION</code> - From transaction history</li> <li><code>NETWORK</code> - From relationship graph</li> </ul>"},{"location":"database/schema/#normalization","title":"Normalization","text":"<p>The database follows 3NF (Third Normal Form): - No transitive dependencies - All non-key attributes depend on primary key - Minimal data redundancy</p>"},{"location":"database/schema/#constraints-summary","title":"Constraints Summary","text":""},{"location":"database/schema/#referential-integrity","title":"Referential Integrity","text":"<ul> <li>All foreign keys enforced with ON DELETE CASCADE</li> <li>Orphaned records prevented</li> </ul>"},{"location":"database/schema/#check-constraints","title":"Check Constraints","text":"<ul> <li><code>kyc_verified</code> between 0-100</li> <li><code>final_score</code> between 300-900</li> <li><code>confidence_level</code> between 0-1</li> <li><code>amount</code> must be positive</li> </ul>"},{"location":"database/schema/#unique-constraints","title":"Unique Constraints","text":"<ul> <li><code>decision_rules.priority</code> must be unique</li> <li><code>model_registry.is_active = 1</code> (only one active model)</li> </ul>"},{"location":"database/schema/#backup-maintenance","title":"Backup &amp; Maintenance","text":""},{"location":"database/schema/#backup-strategy","title":"Backup Strategy","text":"<pre><code>-- Daily full backup\npg_dump kycc_db &gt; backup_$(date +%Y%m%d).sql\n\n-- Point-in-time recovery enabled (WAL archiving)\n</code></pre>"},{"location":"database/schema/#vacuum-analyze","title":"Vacuum &amp; Analyze","text":"<pre><code>-- Weekly vacuum\nVACUUM ANALYZE parties;\nVACUUM ANALYZE features;\nVACUUM ANALYZE score_requests;\n</code></pre>"},{"location":"database/schema/#index-maintenance","title":"Index Maintenance","text":"<pre><code>-- Reindex when fragmented\nREINDEX TABLE features;\nREINDEX TABLE score_requests;\n</code></pre>"},{"location":"database/schema/#performance-tuning","title":"Performance Tuning","text":""},{"location":"database/schema/#partitioning","title":"Partitioning","text":"<p>For high-volume tables, consider partitioning: - <code>score_requests</code> by <code>request_timestamp</code> (monthly) - <code>transactions</code> by <code>transaction_date</code> (yearly)</p>"},{"location":"database/schema/#connection-pooling","title":"Connection Pooling","text":"<p>SQLAlchemy pool settings: <pre><code>engine = create_engine(\n    DATABASE_URL,\n    pool_size=10,\n    max_overflow=20,\n    pool_timeout=30\n)\n</code></pre></p>"},{"location":"database/schema/#query-optimization","title":"Query Optimization","text":"<ul> <li>Use covering indices for common queries</li> <li>Avoid SELECT * (specify columns)</li> <li>Use EXPLAIN ANALYZE for slow queries</li> </ul>"},{"location":"database/schema/#migrations","title":"Migrations","text":"<p>Use Alembic for schema changes: <pre><code># Create migration\nalembic revision --autogenerate -m \"Add column xyz\"\n\n# Apply migration\nalembic upgrade head\n\n# Rollback\nalembic downgrade -1\n</code></pre></p>"},{"location":"guides/scoring/","title":"Credit Scoring Guide","text":""},{"location":"guides/scoring/#overview","title":"Overview","text":"<p>KYCC implements a transparent, explainable credit scoring system using a weighted scorecard model. This guide explains how scores are computed, what factors matter, and how to interpret results.</p>"},{"location":"guides/scoring/#scoring-pipeline","title":"Scoring Pipeline","text":"<p>The scoring process follows five stages:</p> <pre><code>1. Feature Extraction \u2192 2. Normalization \u2192 3. Scorecard Application \u2192\n4. Decision Rules \u2192 5. Audit Logging\n</code></pre>"},{"location":"guides/scoring/#stage-1-feature-extraction","title":"Stage 1: Feature Extraction","text":"<p>Features are extracted from three independent sources in parallel.</p>"},{"location":"guides/scoring/#kyc-features-4-features","title":"KYC Features (4 features)","text":"<p>Extracted from the <code>parties</code> table:</p> Feature Description Range Weight <code>kyc_score</code> KYC verification score 0-100 0.20 <code>company_age_days</code> Days since company created 0-\u221e 0.10 <code>party_type_encoded</code> Numeric encoding of party type 1-5 0.05 <code>contact_completeness</code> % of contact fields filled 0-100 0.00 <p>Why these matter: - kyc_score: Higher compliance = lower regulatory risk - company_age_days: Older companies = more established - party_type: Some types inherently lower risk (e.g., manufacturers) - contact_completeness: Better data quality = more reliable</p>"},{"location":"guides/scoring/#transaction-features-4-features","title":"Transaction Features (4 features)","text":"<p>Extracted from the <code>transactions</code> table:</p> Feature Description Calculation Weight <code>transaction_count</code> Total transactions COUNT(*) 0.25 <code>avg_transaction_amount</code> Mean transaction value AVG(amount) 0.05 <code>transaction_regularity</code> Consistency of txns 1 - (stddev / mean) 0.15 <code>days_since_last_transaction</code> Recency NOW() - MAX(date) 0.10 <p>Why these matter: - transaction_count: More history = better assessment - avg_amount: Transaction size indicates business scale - regularity: Consistent activity = stable business - recency: Recent activity = currently operating</p>"},{"location":"guides/scoring/#network-features-3-features","title":"Network Features (3 features)","text":"<p>Extracted from the <code>relationships</code> table via graph traversal:</p> Feature Description Calculation Weight <code>network_size</code> Parties in component BFS/DFS count 0.10 <code>counterparty_count</code> Direct neighbors COUNT(suppliers + customers) 0.05 <code>network_depth</code> Max relationship hops Longest path length 0.00 <p>Why these matter: - network_size: Larger network = more integrated - counterparty_count: Diversified relationships = lower concentration risk - network_depth: Deep integration = important supply chain player</p>"},{"location":"guides/scoring/#stage-2-normalization","title":"Stage 2: Normalization","text":"<p>Raw features are scaled to 0-1 range using min-max normalization:</p> <pre><code>normalized = (value - min) / (max - min)\n</code></pre>"},{"location":"guides/scoring/#example-normalization","title":"Example Normalization","text":"<pre><code># Raw values\nkyc_score = 85          # Range: 0-100\ncompany_age_days = 180  # Range: 0-365 (assume max 1 year)\ntransaction_count = 15  # Range: 0-20 (assume max for normalization)\n\n# Normalized values\nkyc_norm = 85 / 100 = 0.85\nage_norm = 180 / 365 = 0.49\ncount_norm = 15 / 20 = 0.75\n</code></pre> <p>Why normalize? - Features have different units (days, dollars, counts) - Weights apply consistently across all features - Prevents large-value features from dominating</p>"},{"location":"guides/scoring/#stage-3-scorecard-application","title":"Stage 3: Scorecard Application","text":"<p>The scorecard formula:</p> <pre><code>raw_score = intercept + \u03a3(normalized_feature[i] \u00d7 weight[i])\n</code></pre>"},{"location":"guides/scoring/#default-scorecard-weights","title":"Default Scorecard Weights","text":"Feature Category Weight Sum % of Total Score Transaction Features 0.55 55% KYC Features 0.35 35% Network Features 0.15 15%"},{"location":"guides/scoring/#step-by-step-calculation","title":"Step-by-Step Calculation","text":"<pre><code># Step 1: Apply weights\ncontributions = {\n    'kyc_score': 0.85 \u00d7 0.20 = 0.170,\n    'company_age_days': 0.49 \u00d7 0.10 = 0.049,\n    'party_type_encoded': 0.20 \u00d7 0.05 = 0.010,\n    'transaction_count': 0.75 \u00d7 0.25 = 0.1875,\n    'avg_transaction_amount': 0.67 \u00d7 0.05 = 0.0335,\n    'transaction_regularity': 0.96 \u00d7 0.15 = 0.144,\n    'days_since_last_transaction': 0.99 \u00d7 0.10 = 0.099,\n    'network_size': 0.33 \u00d7 0.10 = 0.033,\n    'counterparty_count': 0.25 \u00d7 0.05 = 0.0125,\n}\n\n# Step 2: Sum contributions\nraw_score = 0.0 + sum(contributions.values()) = 0.769\n\n# Step 3: Scale to 300-900 range\nfinal_score = 300 + (raw_score \u00d7 600) = 300 + 461.4 = 761\n</code></pre>"},{"location":"guides/scoring/#score-bands","title":"Score Bands","text":"Band Range Risk Level Typical Action Excellent 800-900 Very Low Auto-approve, best rates Good 650-799 Low Approve, standard rates Fair 550-649 Medium Manual review required Poor 300-549 High Reject or require collateral"},{"location":"guides/scoring/#stage-4-decision-rules","title":"Stage 4: Decision Rules","text":"<p>After computing the score, business rules are evaluated in priority order (first match wins).</p>"},{"location":"guides/scoring/#example-rules","title":"Example Rules","text":"Priority Condition Action Reason 1 <code>transaction_count == 0</code> REJECT No transaction history 2 <code>kyc_score &lt; 40</code> REJECT Poor KYC compliance 3 <code>network_size &lt; 2</code> FLAG Isolated in supply chain 4 <code>company_age_days &lt; 30</code> MANUAL_REVIEW Too new to assess 5 <code>final_score &gt; 800</code> APPROVE Excellent score 6 <code>final_score &gt; 650</code> APPROVE Good score 7 <code>final_score &gt; 550</code> MANUAL_REVIEW Fair score 8 <code>final_score &lt;= 550</code> REJECT Poor score"},{"location":"guides/scoring/#rule-evaluation-example","title":"Rule Evaluation Example","text":"<pre><code># Party: ACME Suppliers, Score: 761\n# Rules evaluated in priority order:\n\nRule 1: transaction_count == 0? NO (count=15) \u2192 Skip\nRule 2: kyc_score &lt; 40? NO (score=85) \u2192 Skip\nRule 3: network_size &lt; 2? NO (size=2) \u2192 Skip\nRule 4: company_age_days &lt; 30? NO (age=180) \u2192 Skip\nRule 5: final_score &gt; 800? NO (score=761) \u2192 Skip\nRule 6: final_score &gt; 650? YES \u2713 \u2192 MATCH!\n\nDecision: APPROVE\nReason: \"Rule 6: Approve if final_score &gt; 650\"\n</code></pre>"},{"location":"guides/scoring/#stage-5-audit-logging","title":"Stage 5: Audit Logging","text":"<p>Every score computation creates a <code>score_requests</code> record containing:</p> <ul> <li>Complete feature snapshot (JSON)</li> <li>Model version used</li> <li>Raw and final scores</li> <li>Decision and reasons</li> <li>Processing time</li> <li>Timestamp</li> </ul> <p>Benefits: - Explainability: Show which features drove the score - Reproducibility: Replay old scores with old features - Debugging: Investigate unexpected scores - Compliance: Full audit trail for regulators</p>"},{"location":"guides/scoring/#confidence-score","title":"Confidence Score","text":"<p>Confidence indicates data completeness:</p> <pre><code>confidence = available_features / total_expected_features\n</code></pre>"},{"location":"guides/scoring/#confidence-levels","title":"Confidence Levels","text":"Confidence Interpretation Recommended Action 1.0 All features available Fully trust score 0.8-0.99 Most features available Trust score, note missing data 0.5-0.79 Partial feature set Use cautiously, flag for review &lt; 0.5 Insufficient data Do not use score, collect more data"},{"location":"guides/scoring/#feature-importance","title":"Feature Importance","text":"<p>Features ranked by weight (importance):</p> <ol> <li>transaction_count (0.25) - Most important</li> <li>kyc_score (0.20)</li> <li>transaction_regularity (0.15)</li> <li>company_age_days (0.10)</li> <li>days_since_last_transaction (0.10)</li> <li>network_size (0.10)</li> <li>avg_transaction_amount (0.05)</li> <li>counterparty_count (0.05)</li> <li>party_type_encoded (0.05)</li> </ol> <p>Weights sum to 1.0 (100% of score).</p>"},{"location":"guides/scoring/#score-interpretation","title":"Score Interpretation","text":""},{"location":"guides/scoring/#example-acme-suppliers-score-761","title":"Example: ACME Suppliers (Score: 761)","text":"<p>Score Breakdown: <pre><code>Raw Score: 0.769 (76.9% of max)\nFinal Score: 761 (300-900 scale)\nBand: GOOD\nDecision: APPROVE\nConfidence: 0.91 (91% data completeness)\n</code></pre></p> <p>Top Positive Factors: 1. <code>transaction_count</code>: 15 txns (contributed 0.1875 = 18.75% of score) 2. <code>kyc_score</code>: 85/100 (contributed 0.170 = 17.0%) 3. <code>transaction_regularity</code>: 0.96 (contributed 0.144 = 14.4%)</p> <p>Interpretation: ACME has consistent transaction history, good KYC compliance, and regular business activity \u2192 Low risk, approved.</p>"},{"location":"guides/scoring/#example-local-retailer-score-425","title":"Example: Local Retailer (Score: 425)","text":"<p>Score Breakdown: <pre><code>Raw Score: 0.208 (20.8% of max)\nFinal Score: 425\nBand: POOR\nDecision: REJECT\nConfidence: 0.73 (73% data completeness)\n</code></pre></p> <p>Negative Factors: 1. <code>transaction_count</code>: Only 2 txns (low history) 2. <code>company_age_days</code>: 30 days (very new company) 3. <code>network_size</code>: 1 (isolated, no diversification)</p> <p>Interpretation: Insufficient transaction history, new company, isolated in supply chain \u2192 High risk, rejected.</p>"},{"location":"guides/scoring/#model-versioning","title":"Model Versioning","text":"<p>Scoring models are versioned in <code>model_registry</code>:</p> <pre><code>SELECT model_version, deployed_date, is_active\nFROM model_registry\nORDER BY deployed_date DESC;\n\n-- Result:\n-- default_scorecard_v1  2025-12-01  1 (active)\n-- experimental_ml_v1    2025-11-15  0 (inactive)\n</code></pre> <p>Benefits of Versioning: - A/B test new models - Rollback to previous version if needed - Compare model performance over time</p>"},{"location":"guides/scoring/#customizing-scoring","title":"Customizing Scoring","text":""},{"location":"guides/scoring/#adjust-weights","title":"Adjust Weights","text":"<p>To increase emphasis on KYC:</p> <pre><code>weights = {\n    'kyc_score': 0.30,  # Increased from 0.20\n    'transaction_count': 0.20,  # Decreased from 0.25\n    # ... other weights adjusted to sum to 1.0\n}\n</code></pre>"},{"location":"guides/scoring/#add-custom-features","title":"Add Custom Features","text":"<ol> <li>Create new extractor inheriting <code>BaseFeatureExtractor</code></li> <li>Implement <code>extract()</code> method</li> <li>Register in <code>FeaturePipelineService</code></li> <li>Add weight to scorecard model</li> <li>Update <code>feature_definitions</code> table</li> </ol>"},{"location":"guides/scoring/#change-decision-rules","title":"Change Decision Rules","text":"<pre><code>-- Disable rule\nUPDATE decision_rules SET is_active = 0 WHERE rule_id = 'RULE_003';\n\n-- Add new rule\nINSERT INTO decision_rules (rule_id, rule_name, condition_expression, action, priority, is_active)\nVALUES ('RULE_010', 'Flag high-value new companies', 'avg_transaction_amount &gt; 10000 AND company_age_days &lt; 90', 'FLAG', 10, 1);\n</code></pre>"},{"location":"guides/scoring/#best-practices","title":"Best Practices","text":""},{"location":"guides/scoring/#for-accurate-scoring","title":"For Accurate Scoring","text":"<ol> <li>Keep data current: Refresh features every 7 days</li> <li>Validate inputs: Ensure transaction data is clean</li> <li>Monitor confidence: Investigate low-confidence scores</li> <li>Review outliers: Manually check extreme scores (&lt; 400 or &gt; 850)</li> </ol>"},{"location":"guides/scoring/#for-fairness","title":"For Fairness","text":"<ol> <li>Avoid bias: Ensure features don't proxy for protected classes</li> <li>Transparent weights: Document why features are weighted</li> <li>Regular audits: Review decision patterns for disparate impact</li> <li>Explainability: Always provide score breakdown</li> </ol>"},{"location":"guides/scoring/#for-performance","title":"For Performance","text":"<ol> <li>Cache features: Use TTL cache (already implemented)</li> <li>Batch scoring: Score multiple parties in one transaction</li> <li>Async processing: For batch jobs, use background tasks</li> <li>Index optimization: Ensure <code>party_id</code>, <code>feature_name</code> indexed</li> </ol>"},{"location":"guides/scoring/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/scoring/#score-seems-too-low","title":"Score Seems Too Low","text":"<ol> <li>Check feature values: <code>GET /api/scoring/features/{party_id}</code></li> <li>Verify transaction count &gt; 0</li> <li>Check KYC score (should be \u2265 40)</li> <li>Ensure network connections exist</li> </ol>"},{"location":"guides/scoring/#score-not-updating","title":"Score Not Updating","text":"<ol> <li>Clear feature cache: <code>POST /api/scoring/compute-features/{party_id}</code></li> <li>Check <code>valid_to</code> is NULL for current features</li> <li>Verify new transactions are in database</li> </ol>"},{"location":"guides/scoring/#decision-doesnt-match-score","title":"Decision Doesn't Match Score","text":"<ol> <li>Check decision rules: <code>SELECT * FROM decision_rules WHERE is_active = 1</code></li> <li>Review rule priorities (lower = evaluated first)</li> <li>Verify rule conditions match feature values</li> </ol>"},{"location":"guides/scoring/#further-reading","title":"Further Reading","text":"<ul> <li>API Reference: Scoring</li> <li>Database Schema: Features</li> <li>Architecture: Service Layer</li> </ul>"}]}